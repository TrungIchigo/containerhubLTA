### **Mô Tả Chi Tiết Coding: Giao Diện Bảng Điều Phối Mới (Layout 2 Cột & Tabs)**

**Mục tiêu tổng thể:** Tái cấu trúc trang "Bảng Điều Phối" thành một không gian làm việc hiệu quả với layout 2 cột. Cột chính (bên trái) để hiển thị danh sách công việc chính, và cột phụ (bên phải) để hiển thị thông tin chi tiết hoặc ngữ cảnh liên quan, được điều khiển bởi một hệ thống Tab rõ ràng.

### **Hạng Mục 1: Xây Dựng Cấu Trúc Layout Mới**

**Task 1.1: Thiết lập Bố cục 2 Cột và Hệ thống State Chung**

- **File cần làm việc:** src/app/(main)/dispatcher/page.tsx.
- **Yêu cầu về Bố cục:**
    1. Xóa bỏ hoàn toàn bố cục 3 cột hiện tại.
    2. Sử dụng CSS Grid để tạo layout chính:
        - Một container lớn chiếm toàn bộ không gian.
        - Chia thành 2 cột, ví dụ: grid-cols-1 lg:grid-cols-3 gap-6.
        - Cột bên trái (Cột Làm việc) sẽ chiếm 2 phần: lg:col-span-2.
        - Cột bên phải (Cột Ngữ cảnh) sẽ chiếm 1 phần: lg:col-span-1.
- **Yêu cầu về State Management (quan trọng):**
    - Sử dụng **Zustand** hoặc React Context để tạo một store quản lý trạng thái chung cho trang này.
    - **File:** src/stores/dashboard-store.ts
    - **State cần quản lý:**Generated typescript
        
        `interface DashboardState {
          selectedDropOffOrderId: string | null;
          selectedPickupOrderId: string | null;
          selectedSuggestionId: string | null;
          setSelectedDropOffOrder: (id: string | null) => void;
          setSelectedPickupOrder: (id: string | null) => void;
          setSelectedSuggestion: (id: string | null) => void;
        }`
        
        - Việc có state chung này là chìa khóa để hai cột có thể "nói chuyện" với nhau.

---

### **Hạng Mục 2: Xây Dựng Cột Chính (Bên Trái) - Khu Vực Làm Việc**

**Mục tiêu:** Cung cấp các góc nhìn khác nhau về công việc thông qua một hệ thống Tabs.

**Task 2.1: Tích hợp Component <Tabs>**

- **File:** src/app/(main)/dispatcher/page.tsx -> Phần cột trái.
- **Yêu cầu:**
    1. Sử dụng component <Tabs> của Shadcn/ui với defaultValue là "suggestions".
    2. Tạo 3 <TabsTrigger>: **"Gợi ý Tái sử dụng"**, **"Lệnh Giao Trả"**, **"Lệnh Lấy Rỗng"**.

**Task 2.2: Nội dung Tab "Gợi ý Tái sử dụng" (<TabsContent value="suggestions">)**

- **Đây là màn hình mặc định.**
- **Thiết kế:** Hiển thị một **Bảng Xếp Hạng (Leaderboard)** các cơ hội ghép nối tốt nhất trên toàn hệ thống (cả nội bộ và marketplace).
- **Component cần có:** SuggestionLeaderboard.tsx
- **Logic:**
    - Component này fetch và hiển thị danh sách các cặp ghép nối đã được tính điểm, sắp xếp từ cao đến thấp.
    - Mỗi hàng trong bảng xếp hạng sẽ là một Client Component ('use client').
    - Khi người dùng **nhấp** vào một hàng, nó sẽ gọi hàm setSelectedSuggestion(suggestionId) và setSelectedDropOffOrder/setSelectedPickupOrder để cập nhật state chung.
    - Hàng đang được chọn sẽ được highlight màu nền (ví dụ: primary-light).

**Task 2.3: Nội dung Tab "Lệnh Giao Trả" (<TabsContent value="dropoff-orders">)**

- **Thiết kế:** Hiển thị một **bảng chi tiết** tất cả các Lệnh Giao Trả.
- **Component cần có:** FullDropOffOrdersTable.tsx (dựa trên trang danh sách chi tiết hiện tại của bạn - Hình 3).
- **Logic:**
    - Mỗi hàng trong bảng là một Client Component.
    - Khi người dùng **nhấp** vào một hàng, nó sẽ gọi setSelectedDropOffOrder(id) để cập nhật state chung.
    - Hàng đang được chọn cũng được highlight.

**Task 2.4: Nội dung Tab "Lệnh Lấy Rỗng" (<TabsContent value="pickup-orders">)**

- **Thiết kế:** Tương tự Tab Lệnh Giao Trả.
- **Component cần có:** FullPickupOrdersTable.tsx.
- **Logic:** Khi nhấp vào một hàng, nó sẽ gọi setSelectedPickupOrder(id).

---

### **Hạng Mục 3: Xây Dựng Cột Phụ (Bên Phải) - Khu Vực Ngữ Cảnh**

**Mục tiêu:** Hiển thị thông tin chi tiết và hành động liên quan đến mục đã được chọn ở cột chính.

**Task 3.1: Tạo Component ContextualSidebar.tsx**

- **File:** src/components/features/dispatcher/dashboard/ContextualSidebar.tsx
- **Mục tiêu:** Đây là một component "thông minh", nó sẽ đọc state chung và quyết định hiển thị nội dung gì.
- **Yêu cầu (Logic bên trong):**Generated tsx
    
    `'use client';
    import { useDashboardStore } from '@/stores/dashboard-store';
    
    export function ContextualSidebar() {
        const { selectedSuggestionId, selectedDropOffOrderId, selectedPickupOrderId } = useDashboardStore();
    
        // Ưu tiên hiển thị chi tiết của Gợi ý được chọn
        if (selectedSuggestionId) {
            return <SuggestionDetails suggestionId={selectedSuggestionId} />;
        }
    
        // Nếu không có gợi ý nào được chọn, thì hiển thị gợi ý cho Lệnh được chọn
        if (selectedDropOffOrderId) {
            return <RelatedSuggestionsForDropOffOrder orderId={selectedDropOffOrderId} />;
        }
        
        if (selectedPickupOrderId) {
            return <RelatedSuggestionsForPickupOrder orderId={selectedPickupOrderId} />;
        }
    
        // Trạng thái mặc định khi không có gì được chọn
        return <DefaultSidebarState />;
    }`
    

**Task 3.2: Nội dung cho từng State của Sidebar**

1. **Component SuggestionDetails:**
    - Khi một gợi ý trên leaderboard được chọn, component này sẽ fetch (hoặc nhận) dữ liệu chi tiết của gợi ý đó.
    - Nó sẽ hiển thị y hệt như phần "Chi tiết" mà chúng ta đã thiết kế: phân tích điểm số, loại kịch bản, các tác vụ phải làm thêm, chi phí phát sinh và **nút "Tạo Yêu cầu"**.
2. **Component RelatedSuggestionsForDropOffOrder:**
    - Khi người dùng ở tab "Lệnh Giao Trả" và chọn một lệnh, component này sẽ được hiển thị.
    - Nó sẽ fetch và hiển thị một **danh sách rút gọn các Lệnh Lấy Rỗng tốt nhất có thể ghép với chỉ Lệnh Giao Trả đang được chọn này**. Về cơ bản, nó là phiên bản thu nhỏ của màn hình gợi ý 1-nhiều.
3. **Component DefaultSidebarState:**
    - Khi không có gì được chọn, sidebar sẽ hiển thị thông tin chung, một hình ảnh minh họa, hoặc một vài "Mẹo & Thủ thuật" để sử dụng hệ thống hiệu quả. Ví dụ: "Mẹo: Hãy luôn điền đầy đủ thông tin để tăng điểm số ghép nối của bạn!".