### **Mô Tả Chi Tiết: Nâng Cấp Trang Quản Lý Tài Khoản**

**Mục tiêu tổng thể:** Tái thiết kế trang Quản lý tài khoản để hiển thị thông tin một cách toàn diện, phân cấp rõ ràng, đồng thời mang lại một trải nghiệm người dùng hiện đại, chuyên nghiệp và dễ dàng cho việc chỉnh sửa.

### **Hạng Mục 1: Cải Tiến Bố Cục & Giao Diện Tổng Thể**

**Task 1.1: Áp dụng Bố cục 2 Cột Linh Hoạt**

- **Mục tiêu:** Thay thế layout một cột hiện tại bằng layout hai cột để phân tách thông tin cá nhân và thông tin tổ chức/bảo mật.
- **Yêu cầu về Bố cục:**
    - Sử dụng CSS Grid để tạo layout 2 cột trên các màn hình lớn (md:grid-cols-3):
        - **Cột Bên Trái (1/3 chiều rộng):** Sẽ là khu vực hiển thị Avatar, Tên, Vai trò và một menu điều hướng phụ.
        - **Cột Bên Phải (2/3 chiều rộng):** Sẽ là khu vực nội dung chính, chứa các form và thông tin chi tiết.

### **Hạng Mục 2: Thiết Kế Lại Cột Bên Trái - "Hồ Sơ Nhanh" & Điều Hướng Phụ**

**Task 2.1: Xây Dựng Component ProfileSidebar.tsx**

- **File cần tạo:** src/components/features/account/ProfileSidebar.tsx.
- **Mục tiêu:** Tạo ra một thẻ thông tin cá nhân trực quan và một menu điều hướng cho các mục trong trang tài khoản.
- **Yêu cầu về Giao diện:**
    1. **Component <Card> làm khung chính.**
    2. **Khu vực Avatar & Tên:**
        - Một component <Avatar> lớn ở trên cùng.
        - Bên dưới là **Họ và Tên** (full_name từ bảng profiles) - chữ lớn, font-bold.
        - Email (email từ bảng auth.users) - chữ nhỏ hơn, text-secondary.
    3. **Khu vực Vai trò & Tổ chức:**
        - Hiển thị **Vai trò** (role từ profiles) dưới dạng một <Badge>. Ví dụ: Dispatcher.
        - Hiển thị **Tên Công ty/Tổ chức** (name từ bảng organizations qua join).
    4. **Menu Điều hướng Phụ:**
        - Một danh sách các nút <Button variant="ghost"> căn trái, chiếm toàn bộ chiều rộng.
        - Mỗi nút là một link hoặc sẽ điều khiển việc hiển thị component ở cột bên phải.
        - Các mục menu:
            - 👤 Hồ sơ (Mặc định được chọn)
            - 🏢 Thông tin Tổ chức
            - 🔒 Bảo mật & Đăng nhập

---

### **Hạng Mục 3: Thiết Kế Lại Cột Bên Phải - Nội Dung Chi Tiết (Điều khiển bởi Menu Phụ)**

**Mục tiêu:** Hiển thị nội dung tương ứng với mục được chọn ở menu cột trái.

**Task 3.1: Component AccountDetails.tsx (Tương ứng với mục "Hồ sơ")**

- **Thiết kế:**
    - Một <Card> lớn chứa nội dung.
    - <CardHeader>: Tiêu đề "Thông tin cá nhân".
    - <CardContent>: Form cho phép chỉnh sửa các trường:
        - **Họ và Tên (full_name):** <Input> có sẵn giá trị.
        - **Số điện thoại (phone_number từ profiles - CẦN THÊM VÀO SCHEMA):** <Input>. Đây là thông tin cá nhân nên thuộc về profile.
        - **Avatar:** Component tải ảnh lên để người dùng có thể thay đổi ảnh đại diện.
- **Hành động:** Nút "Lưu thay đổi".

**Task 3.2: Component OrganizationDetails.tsx (Tương ứng với mục "Thông tin Tổ chức")**

- **Thiết kế:**
    - <CardHeader>: Tiêu đề "Thông tin Tổ chức".
    - <CardContent>: Hiển thị thông tin của tổ chức mà người dùng thuộc về. **Tất cả các trường đều là chỉ đọc (read-only) cho vai trò Dispatcher.**
        - **Tên Công ty/Tổ chức (name):** Hiển thị dạng text.
        - **Mã số thuế (tax_code):** Hiển thị dạng text.
        - **Địa chỉ trụ sở (address):** Hiển thị dạng text.
        - **Số điện thoại công ty (phone_number):** Hiển thị dạng text.
        - **Trạng thái (status):** Hiển thị dưới dạng <Badge> (ví dụ: ACTIVE).
- **Ghi chú:** Có một dòng ghi chú: *"Thông tin này chỉ có thể được thay đổi bởi người quản trị của tổ chức hoặc Admin hệ thống."*

**Task 3.3: Component SecuritySettings.tsx (Tương ứng với mục "Bảo mật & Đăng nhập")**

- **Thiết kế:**
    - **Khu vực 1: Đổi Mật khẩu:**
        - <CardHeader>: "Thay đổi mật khẩu".
        - <CardContent>: Form chứa 3 ô: Mật khẩu hiện tại, Mật khẩu mới, Xác nhận mật khẩu mới.
    - **Khu vực 2 (Nâng cao): Tùy chọn Đăng nhập eDepot:**
        - <CardHeader>: "Liên kết tài khoản".
        - <CardContent>:
            - Hiển thị trạng thái liên kết:
                - **Nếu edepot_username đã có giá trị:** Hiển thị ✅ Đã liên kết với tài khoản eDepot: [edepot_username]. Kèm nút "Hủy liên kết".
                - **Nếu edepot_username là NULL:** Hiển thị một nút Liên kết với tài khoản eDepot, khi nhấn sẽ mở ra một quy trình để người dùng nhập user/pass eDepot và xác thực.

---

### **Hạng Mục 4: Cập Nhật CSDL & Logic Backend**

**Task 4.1: Cập nhật Schema CSDL (nếu cần)**

- **Yêu cầu (SQL):**codeSQL
    
    ```
    -- Thêm cột số điện thoại và avatar vào bảng profiles
    ALTER TABLE public.profiles
    ADD COLUMN phone_number TEXT,
    ADD COLUMN avatar_url TEXT;
    ```
    

**Task 4.2: Cập Nhật Logic Fetch Dữ Liệu Trang account/page.tsx**

- **Yêu cầu:** Trang này cần phải fetch dữ liệu từ nhiều bảng và JOIN chúng lại.
- **Câu lệnh Supabase gợi ý (trong Server Component):**codeTypeScript
    
    ```
    const { data: { user } } = await supabase.auth.getUser();
    
    // Lấy profile và JOIN với organization
    const { data: userProfile, error } = await supabase
      .from('profiles')
      .select(`
        *,
        organizations (
          name,
          tax_code,
          address,
          phone_number,
          status
        )
      `)
      .eq('id', user.id)
      .single();
    
    // user.email sẽ có email
    // userProfile sẽ chứa toàn bộ thông tin còn lại
    ```
    

Bằng cách tái cấu trúc theo mô hình này, trang quản lý tài khoản của bạn sẽ trở nên cực kỳ chuyên nghiệp, logic và cung cấp đầy đủ thông tin cho người dùng một cách trực quan.