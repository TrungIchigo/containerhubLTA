## Yêu cầu Tái sử dụng Container Nội bộ ##

# **Case 1.1A: Street-turn "Trên Đường" (Kịch bản Lý tưởng) - cùng Hãng Tàu**

**1. Tên kịch bản**

- Tạo Yêu cầu Tái sử dụng Container "Trên đường" (Pre-Depot Street-turn) - xe chưa trả rỗng về lại Depot chỉ định.

**2. ID kịch bản**

- FEAT-ST-INTERNAL-001A

**3. Mục tiêu (Business Goal)**

- Giúp NVT ghép nối một container vừa dỡ hàng xong với một nhu cầu đóng hàng mới ngay lập tức, trước khi container đó phải thực hiện chuyến đi trả rỗng về depot.

**4. Vai trò tham gia (Actors)**

- **Thực hiện chính:** Điều phối viên (Dispatcher).
- **Phê duyệt:** Quản trị viên LTA (LTA Admin).
- **Ảnh hưởng:** Tài xế, Kế toán NVT.

**5. Bối cảnh (Pre-condition)**

- Dispatcher đã tạo một "Lệnh Giao Trả" (LGT) và một "Lệnh Lấy Rỗng" (LLR) trên hệ thống.
- Cả hai lệnh đều đang ở trạng thái Sẵn sàng.
- Container của LGT vẫn đang ở kho của khách hàng hoặc đang trên đường, chưa gate-in vào depot trả rỗng.
- Hệ thống xác định hai lệnh này thỏa mãn điều kiện ghép nối (cùng loại cont, cùng hãng tàu, thời gian, khoảng cách phù hợp).

**6. Luồng chính (Happy Path)**

1. **[Dispatcher]** Trên "Bảng Điều Phối", xem khu vực "Gợi Ý Tái Sử Dụng".
2. **[Hệ thống]** Hiển thị gợi ý ghép nối cho cặp LGT và LLR tương ứng.
3. **[Dispatcher]** Nhấn nút **"Tạo Yêu Cầu"**.
4. **[Hệ thống]** Tạo Yêu cầu Street-turn với trạng thái Chờ duyệt, đồng thời khóa LGT và LLR lại.
5. **[LTA Admin]** Nhận và phê duyệt yêu cầu.
6. **[Hệ thống]** Cập nhật trạng thái yêu cầu thành Đã duyệt và gửi thông báo.
7. **[Dispatcher]** Nhận thông báo và điều phối tài xế lái xe từ điểm dỡ hàng của LGT thẳng đến điểm đóng hàng của LLR.

**7. Phản hồi hệ thống**

- Hiển thị gợi ý trên dashboard.
- Hiển thị Toast "Gửi yêu cầu thành công" và cập nhật trạng thái các lệnh thành "Chờ duyệt".
- Hiển thị Toast real-time "Yêu cầu đã được phê duyệt" và cập nhật trạng thái thành "Đã duyệt/Đã ghép".

**8. Ngoại lệ (Exception flows)**

- **LTA Admin từ chối:** Các lệnh được rollback về trạng thái "Sẵn sàng".
- **Dispatcher hủy yêu cầu:** Tương tự, các lệnh được rollback.
- **Hết thời gian ra quyết định:** Nếu Dispatcher không tạo yêu cầu ghép nối trong một khoảng thời gian nhất định sau khi dỡ hàng, cơ hội có thể bị bỏ lỡ (tài xế phải rời đi). -> *Đây là một điểm hệ thống có thể cải tiến bằng thông báo nhắc nhở.*

**9. Luồng thay thế (Alternate Path)**

- Dispatcher có thể quyết định không thực hiện street-turn và tiến hành yêu cầu COD hoặc cho xe trả rỗng về depot.

**10. Trạng thái sau cùng (Post-condition)**

- **Thành công:** Một yêu cầu Đã duyệt được tạo. Lệnh Giao Trả và Lệnh Lấy Rỗng được coi là đã hoàn thành thông qua street-turn. Chuyến đi trả rỗng và lấy rỗng tại depot bị loại bỏ.
- **Thất bại:** Các lệnh quay về trạng thái Sẵn sàng để tìm kiếm các cơ hội tối ưu hóa khác.

**11. Quy tắc nghiệp vụ (Business Rules)**

- Yêu cầu chỉ có thể được tạo khi Lệnh Giao Trả chưa được xác nhận là đã "hoàn tất" (tức là chưa về depot).


# **Case 1.1B: Street-turn "Tại Depot" (Tối ưu hóa Vòng quay) - cùng Hãng Tàu**

**1. Tên kịch bản**

- Tái sử dụng Container Tại Depot (In-Depot Reuse / Depot Interchange)

**2. ID kịch bản**

- FEAT-ST-INTERNAL-001B

**3. Mục tiêu (Business Goal)**

- Giúp NVT tái sử dụng ngay lập tức một container vừa được trả vào depot cho một nhu cầu lấy rỗng khác tại chính depot đó, loại bỏ chi phí và thời gian cho một chuyến xe không tải mới phải chạy đến depot để lấy container.

**4. Vai trò tham gia (Actors)**

- Tương tự Case 1.1A.

**5. Bối cảnh (Pre-condition)**

- Dispatcher vừa cập nhật một "Lệnh Giao Trả" (LGT) thành trạng thái Hoàn tất tại Depot X.
- Công ty của Dispatcher có một "Lệnh Lấy Rỗng" (LLR) ở trạng thái Sẵn sàng yêu cầu lấy container tại chính Depot X.
- Hai lệnh thỏa mãn điều kiện về loại container và hãng tàu.
- Thời gian cần lấy rỗng của LLR diễn ra ngay sau hoặc trong một khoảng thời gian ngắn (ví dụ: < 4 giờ) sau khi LGT được hoàn tất.

**6. Luồng chính (Happy Path)**

1. **[Hệ thống]** Ngay khi LGT được cập nhật thành Hoàn tất, hệ thống tự động quét các LLR của cùng công ty.
2. **[Hệ thống]** Phát hiện cơ hội tái sử dụng tại depot, hệ thống gửi một **Thông báo Ưu tiên** cho Dispatcher: "Cơ hội tại Depot X! Giữ lại container [số cont] cho lệnh lấy rỗng [số booking] để tiết kiệm một chuyến xe không tải?".
3. **[Dispatcher]** Nhận thông báo và nhấn **"Tạo Yêu cầu Giữ Container"**.
4. **[Hệ thống]** Tạo một loại yêu cầu đặc biệt (IN_DEPOT_REUSE) với trạng thái Chờ duyệt và gửi đến LTA Admin.
5. **[LTA Admin]** Nhận và phê duyệt yêu cầu (việc này có thể cần LTA liên hệ với depot để xác nhận).
6. **[Hệ thống]** Cập nhật trạng thái yêu cầu thành Đã duyệt.
7. **[Dispatcher]** Điều phối cho tài xế (nếu là cùng một người) ở lại depot để nhận giấy tờ cho chuyến đi mới, hoặc thông báo cho một tài xế khác đến depot X để nhận đúng container đó.

**7. Phản hồi hệ thống**

- Gửi thông báo đẩy (push notification) hoặc email ưu tiên cho Dispatcher.
- Tạo một loại yêu cầu mới trên giao diện quản lý.
- Cập nhật trạng thái các lệnh tương ứng.

**8. Ngoại lệ (Exception flows)**

- **LTA Admin từ chối:** Có thể do depot không đồng ý giữ lại hoặc container đó cần được kiểm tra/sửa chữa ngay. Dispatcher sẽ nhận thông báo và phải thực hiện lệnh lấy rỗng như bình thường.
- **Dispatcher bỏ lỡ thông báo:** Nếu Dispatcher không phản hồi trong một khoảng thời gian ngắn, cơ hội sẽ mất (container sẽ được đưa vào bãi chung của depot).

**9. Luồng thay thế (Alternate Path)**

- Dispatcher không sử dụng tính năng này và thực hiện quy trình thủ công: cho một xe đầu kéo khác chạy đến depot để lấy một container rỗng ngẫu nhiên.

**10. Trạng thái sau cùng (Post-condition)**

- **Thành công:** Một chuyến xe không tải đến depot đã được loại bỏ. Lệnh Lấy Rỗng được hoàn thành bằng chính container của Lệnh Giao Trả.
- **Thất bại:** Mọi thứ diễn ra như bình thường, NVT chịu chi phí cho một chuyến xe không tải.

**11. Quy tắc nghiệp vụ (Business Rules)**

- Logic quét tự động chỉ kích hoạt khi Lệnh Giao Trả và Lệnh Lấy Rỗng xảy ra tại cùng một depot_id.
- Có một ngưỡng thời gian (configurable) để xác định một cơ hội là "tiềm năng" (ví dụ: cách nhau không quá 4 giờ).

# **Case 1.2: Gợi ý ghép nối Street-Turn khác Hãng Tàu**

**1. Tên kịch bản**

- Hỗ trợ Điều chỉnh Lệnh để Tối ưu hóa Street-turn Khác Hãng tàu (Assisted Cross-Liner Street-turn)

**2. ID kịch bản**

- FEAT-ST-INTERNAL-002

**3. Mục tiêu (Business Goal)**

- Giúp Dispatcher nhận diện được các cơ hội street-turn "gần như hoàn hảo" (chỉ khác hãng tàu) và cung cấp một công cụ để họ có thể nhanh chóng điều chỉnh "Lệnh Lấy Rỗng" của mình cho phù hợp, từ đó tận dụng được cơ hội tối ưu hóa mà không cần can thiệp thủ công phức tạp.

**4. Vai trò tham gia (Actors)**

- **Thực hiện chính:** Điều phối viên (Dispatcher).
- **Phê duyệt:** Quản trị viên LTA (LTA Admin).
- **Ảnh hưởng:** Hãng tàu (nhận được booking mới/thay đổi), Kế toán NVT.

**5. Bối cảnh (Pre-condition)**

- Dispatcher đã đăng nhập vào hệ thống.
- Công ty của Dispatcher có một "Lệnh Giao Trả" (LGT) của **Hãng tàu A (ví dụ: Maersk)** ở trạng thái Sẵn sàng.
- Công ty của Dispatcher có một "Lệnh Lấy Rỗng" (LLR) ở trạng thái Sẵn sàng nhưng lại yêu cầu container của **Hãng tàu B (ví dụ: ONE)**.
- Hai lệnh này thỏa mãn TẤT CẢ các điều kiện khác: cùng loại container, thời gian và khoảng cách địa lý phù hợp.

**6. Luồng chính (Happy Path)**

1. **[Hệ thống]** Khi quét tìm gợi ý, hệ thống phát hiện ra cặp LGT và LLR tiềm năng này nhưng nhận thấy chúng khác hãng tàu.
2. **[Hệ thống]** Thay vì bỏ qua, hệ thống hiển thị một gợi ý đặc biệt trong một khu vực riêng trên Dashboard, ví dụ: "Gợi ý có điều kiện".
3. **[Hệ thống]** Gợi ý này ghi rõ: "Cơ hội ghép nối Lệnh [số cont] (Maersk) với Lệnh [số booking] (ONE). Yêu cầu thay đổi hãng tàu trên Lệnh Lấy Rỗng.**"
4. **[Dispatcher]** Nhìn thấy gợi ý, Anna nhận ra đây là một cơ hội tốt. Cô ấy tiến hành các nghiệp vụ ngoài hệ thống (hủy booking với ONE và đặt một booking mới với Maersk).
5. **[Dispatcher]** Sau khi có số booking mới của Maersk, cô ấy nhấn vào nút **"Điều chỉnh & Ghép nối"** trên gợi ý.
6. **[Hệ thống]** Mở ra một phiên bản của form "Sửa Lệnh Lấy Rỗng".
7. **[Dispatcher]** Cô ấy cập nhật lại "Số Booking" mới, hệ thống có thể đã tự động chọn sẵn "Hãng tàu" là Maersk. Cô ấy có thể đính kèm email xác nhận booking mới vào mục "Tài liệu Thay đổi" và thêm ghi chú vào "Ghi chú Nội bộ".
8. **[Dispatcher]** Nhấn "Lưu & Tạo Yêu cầu".
9. **[Hệ thống]** Dữ liệu của "Lệnh Lấy Rỗng" được cập nhật, và một "Yêu cầu Street-turn" mới (giờ đã cùng hãng tàu) được tự động tạo và gửi đến LTA Admin để duyệt như bình thường.

**7. Phản hồi hệ thống (System Feedback)**

- Hiển thị các gợi ý "có điều kiện" một cách trực quan, có thể có màu sắc khác để phân biệt.
- Khi nhấn "Điều chỉnh & Ghép nối", form sửa lệnh được mở ra, có thể có các gợi ý hoặc tự động điền các thông tin phù hợp.
- Sau khi lưu, hiển thị Toast: "Lệnh đã được cập nhật. Yêu cầu tái sử dụng đã được gửi đi thành công!".

**8. Ngoại lệ (Exception flows)**

- **Dispatcher không thể đổi booking:** Nếu việc hủy booking cũ hoặc đặt booking mới với hãng tàu kia không thành công, Dispatcher có thể bỏ qua gợi ý này. Gợi ý sẽ tự động biến mất sau một thời gian hoặc khi một trong hai lệnh được sử dụng cho việc khác.
- **Thông tin không khớp sau khi sửa:** Nếu sau khi sửa, Lệnh Lấy Rỗng không còn khớp với Lệnh Giao Trả nữa (ví dụ: đổi sang loại container khác), hệ thống sẽ báo lỗi và không cho phép tạo yêu cầu street-turn.

**9. Luồng thay thế (Alternate Path)**

- Dispatcher hoàn toàn có thể thực hiện việc này thủ công: tự mình sửa "Lệnh Lấy Rỗng" trước, sau đó quay lại dashboard và chờ hệ thống hiển thị gợi ý ghép nối thông thường. Luồng "Điều chỉnh & Ghép nối" chỉ là một "lối tắt" thông minh để làm cho quy trình này nhanh hơn.

**10. Trạng thái sau cùng (Post-condition)**

- **Thành công:** "Lệnh Lấy Rỗng" được cập nhật với thông tin hãng tàu và booking mới. Một yêu cầu street-turn hợp lệ được tạo ra và đi vào luồng phê duyệt của LTA Admin.
- **Thất bại/Bỏ qua:** Các lệnh vẫn giữ nguyên trạng thái Sẵn sàng để chờ các cơ hội khác.

**11. Quy tắc nghiệp vụ (Business Rules)**

- Hệ thống chỉ gợi ý kịch bản này khi TẤT CẢ các điều kiện khác (loại cont, thời gian, địa điểm) đều khớp hoàn hảo.
- Hệ thống không tự động thay đổi bất kỳ dữ liệu nào. Mọi thay đổi trên "Lệnh Lấy Rỗng" đều phải do Dispatcher chủ động thực hiện và xác nhận.
- Việc cho phép sửa lệnh mà không cần admin duyệt là một quy tắc quan trọng của luồng này, thể hiện sự tin tưởng và trao quyền cho người dùng tự quản lý các lệnh của họ trước khi chúng được đưa vào một giao dịch chính thức.

---


## Yêu cầu Tái sử dụng Container Khác NVT ##

# **Case 2.1: Khác NVT & Cùng Hãng Tàu - Mô hình "Sàn Giao Dịch Công Việc"**

**1. Tên kịch bản**

- Thực hiện Ghép nối Street-turn Chéo Công ty thông qua Trung gian LTA (LTA-Mediated Marketplace Street-turn)

**2. ID kịch bản**

- FEAT-ST-MARKETPLACE-001

**3. Mục tiêu (Business Goal)**

- Tối đa hóa hiệu quả sử dụng container trên toàn hệ thống bằng cách kết nối nhu cầu giữa các công ty vận tải khác nhau.
- Tạo ra một mô hình kinh doanh mới cho LTA, nơi LTA đóng vai trò là nhà điều phối trung gian, đảm bảo giao dịch và thu phí dịch vụ.
- Cung cấp một giải pháp cho các NVT có năng lực vận tải hạn chế (NVT 2) và tối ưu hóa lộ trình cho các NVT có container rảnh ở vị trí thuận lợi (NVT 1).

**4. Vai trò tham gia (Actors)**

- **Người Bán Lệnh (Seller):** Điều phối viên của Công ty Vận tải 2 (NVT 2) - bên có "Lệnh Lấy Rỗng".
- **Người Thực Hiện (Executor):** Điều phối viên của Công ty Vận tải 1 (NVT 1) - bên có "Lệnh Giao Trả".
- **Nhà Điều Phối & Trung Gian:** Quản trị viên LTA (LTA Admin).

**5. Bối cảnh (Pre-condition)**

- NVT 1 đã tạo một "Lệnh Giao Trả" (LGT-A) cho container Maersk, trạng thái Sẵn sàng, và đã tick chọn "Chào bán cơ hội này lên Thị trường".
- NVT 2 đã tạo một "Lệnh Lấy Rỗng" (LLR-B) yêu cầu container Maersk, trạng thái Sẵn sàng.
- Hai lệnh này thỏa mãn tất cả các điều kiện ghép nối (loại cont, thời gian, khoảng cách địa lý).
- NVT 2 mong muốn "thuê ngoài" việc thực hiện LLR-B này.

**6. Luồng chính (Happy Path)**

1. **[NVT 2 - Bên Bán Lệnh]:** Khi tạo/sửa LLR-B, Dispatcher của NVT 2 tick vào một checkbox mới: **"Chào thầu công việc vận chuyển này trên Marketplace"**.
2. **[Hệ thống]:** LLR-B được đưa vào một "bể công việc" (Job Pool) trên Marketplace, sẵn sàng để được ghép nối.
3. **[Hệ thống - Bộ não ghép lệnh]:** Hệ thống tự động quét và phát hiện cơ hội ghép nối hoàn hảo giữa LGT-A của NVT 1 và LLR-B của NVT 2.
4. **[Hệ thống]:** Thay vì chỉ gợi ý, hệ thống tạo ra một "Giao dịch Đề xuất" (Proposed Transaction) và đưa nó vào hàng chờ của **LTA Admin**.
5. **[LTA Admin]:** Trên Admin Dashboard, thấy một mục mới "Giao dịch Marketplace Chờ Xử lý". Admin xem xét chi tiết giao dịch, bao gồm:
    - Thông tin LGT-A (từ NVT 1).
    - Thông tin LLR-B (từ NVT 2).
    - Lộ trình tối ưu hóa: Điểm dỡ hàng của A -> Điểm đóng hàng của B.
    - Cước phí vận chuyển ước tính (dựa trên công thức 5.000 VNĐ/km) mà NVT 1 sẽ nhận được.
    - Phí dịch vụ mà LTA sẽ thu.
6. **[LTA Admin]:** Nhấn nút **"Gửi Đề nghị cho Người Thực hiện"**.
7. **[NVT 1 - Bên Thực Hiện]:** Nhận được một thông báo/yêu cầu mới trong một tab đặc biệt: **"Đề nghị từ Thị trường"**. Yêu cầu này ghi rõ: "Bạn có một đề nghị thực hiện công việc vận chuyển cho một đối tác (ẩn danh) bằng cách tái sử dụng container [số cont]. Cước phí ước tính: [số tiền]."
8. **[NVT 1]:** Nhấn **"Chấp thuận Đề nghị"**.
9. **[Hệ thống]:** Giao dịch được xác nhận!
    - Trạng thái của Yêu cầu Street-turn này đổi thành Đã duyệt.
    - Trạng thái của LGT-A và LLR-B đổi thành Đã ghép.
    - Hệ thống tạo ra một công nợ cước vận chuyển (LTA trả cho NVT 1) và một công nợ phí dịch vụ (NVT 2 trả cho LTA).
    - Gửi thông báo thành công cho cả NVT 1 và NVT 2. NVT 1 nhận được chi tiết lộ trình mới.

**7. Phản hồi hệ thống**

- Giao diện cho NVT 2 để "chào thầu" công việc.
- Giao diện cho LTA Admin để xem xét và điều phối giao dịch.
- Giao diện cho NVT 1 để nhận và chấp thuận đề nghị.
- Thông báo real-time cho tất cả các bên ở mỗi bước của quy trình.

**8. Ngoại lệ (Exception flows)**

- **NVT 1 từ chối đề nghị:** Giao dịch bị hủy. LGT-A của NVT 1 quay lại trạng thái Sẵn sàng trên Marketplace. LLR-B của NVT 2 cũng quay lại trạng thái Sẵn sàng để hệ thống tìm cơ hội khác.
- **LTA Admin không tìm thấy ai thực hiện:** Nếu không có NVT nào phù hợp để thực hiện công việc, LLR-B của NVT 2 sẽ nằm trong "bể công việc" chờ đợi.
- **Tranh chấp sau giao dịch:** (ví dụ: NVT 1 giao hàng trễ). LTA Admin sẽ đóng vai trò trung gian giải quyết dựa trên Audit Log và các điều khoản dịch vụ.

**9. Luồng thay thế (Alternate Path)**

- NVT 2 không chọn "chào thầu công việc" mà tự mình vào Marketplace để tìm một Lệnh Giao Trả phù hợp và tạo yêu cầu ghép nối thông thường.

**10. Trạng thái sau cùng (Post-condition)**

- **Thành công:** Một giao dịch street-turn chéo công ty được thực hiện. NVT 1 có thêm doanh thu cước vận tải. NVT 2 hoàn thành công việc của mình mà không cần dùng đến xe của họ. LTA có doanh thu từ phí dịch vụ.
- **Thất bại:** Các lệnh quay về trạng thái ban đầu.

**11. Quy tắc nghiệp vụ (Business Rules)**

- NVT 1 và NVT 2 được giữ ẩn danh với nhau trong suốt quá trình. Mọi giao tiếp phải thông qua nền tảng và LTA Admin.
- Cơ chế tính cước và phí dịch vụ phải được định nghĩa rõ ràng và minh bạch cho các bên trước khi xác nhận giao dịch.
- Chỉ các NVT có điểm đánh giá uy tín từ một ngưỡng nhất định mới được tham gia vào mô hình này.

![Editor _ Mermaid Chart-2025-06-24-035024.png](attachment:22402e7a-edb5-4c70-b986-19e0e40b7515:Editor___Mermaid_Chart-2025-06-24-035024.png)

---

# **Case 2.2: Khác NVT & Khác Hãng Tàu - Mô hình "Sàn Giao Dịch Công Việc"**

**1. Tên kịch bản**

- Gợi ý và Hỗ trợ Điều chỉnh cho Cơ hội Ghép nối Chéo Công ty, Khác Hãng tàu (Assisted Cross-Liner, Cross-Company Street-turn)

**2. ID kịch bản**

- FEAT-ST-MARKETPLACE-002

**3. Mục tiêu (Business Goal)**

- Phát hiện các cơ hội tối ưu hóa "vàng" (hoàn hảo về địa điểm, thời gian, loại cont) đang bị bỏ lỡ chỉ vì rào cản về hãng tàu.
- Cung cấp thông tin và công cụ một cách chủ động để người dùng (NVT 2) có thể tự mình thực hiện các thay đổi nghiệp vụ cần thiết (đổi booking) và sau đó quay lại tận dụng cơ hội trên nền tảng.
- Tăng tối đa khả năng chuyển đổi của các cơ hội trên Marketplace.

**4. Vai trò tham gia (Actors)**

- **Người nhận gợi ý & Thực hiện thay đổi:** Điều phối viên của Công ty Vận tải 2 (NVT 2) - bên có "Lệnh Lấy Rỗng".
- **Người chờ đợi:** Điều phối viên của Công ty Vận tải 1 (NVT 1) - bên có "Lệnh Giao Trả" trên Marketplace.
- **Nhà điều phối (nếu thành công):** Quản trị viên LTA (LTA Admin).

**5. Bối cảnh (Pre-condition)**

- NVT 1 đã "chào bán" một "Lệnh Giao Trả" (LGT-A) của **Hãng tàu A (Maersk)** lên Marketplace.
- NVT 2 đã tạo một "Lệnh Lấy Rỗng" (LLR-B) yêu cầu container của **Hãng tàu B (ONE)**.
- Hai lệnh này thỏa mãn TẤT CẢ các điều kiện khác: cùng loại container, thời gian và khoảng cách địa lý cực kỳ tối ưu.

**6. Luồng chính (Happy Path)**

1. **[Hệ thống - Bộ não ghép lệnh]:** Hệ thống tự động quét và phát hiện ra cơ hội "vàng" này. Nó nhận diện được rào cản duy nhất là "khác hãng tàu".
2. **[Hệ thống] Gửi Gợi ý Thông minh:** Hệ thống gửi một thông báo đẩy (push notification) và hiển thị một gợi ý nổi bật trên Dashboard của **NVT 2**:
    
    > "Cơ hội Tối ưu Cao!"
    > 
    > 
    > "Chúng tôi tìm thấy một container **Maersk** sẵn sàng tại [Địa điểm X], hoàn toàn khớp với nhu cầu lấy rỗng của bạn tại [Địa điểm Y]. Để tận dụng cơ hội này và tiết kiệm chi phí, bạn cần có một booking tương ứng với hãng tàu **Maersk**."
    > 
3. **[NVT 2] Ra quyết định nghiệp vụ:** Dispatcher của NVT 2 nhận được gợi ý. Họ xem xét (ví dụ: cước phí của Maersk có tốt không, việc đổi booking có phức tạp không) và quyết định sẽ thực hiện thay đổi.
4. **[NVT 2] Thực hiện nghiệp vụ ngoài hệ thống:** Họ liên hệ với hãng tàu ONE để hủy booking cũ và đặt một booking mới với hãng tàu Maersk.
5. **[NVT 2] Cập nhật trên i-ContainerHub:** Sau khi có số booking mới của Maersk, Dispatcher của NVT 2 vào hệ thống, tìm đến "Lệnh Lấy Rỗng" của mình và nhấn **"Sửa"**.
6. **[NVT 2]** Họ cập nhật lại **Số Booking** và quan trọng nhất là đổi **Hãng tàu** từ ONE sang Maersk. Họ có thể đính kèm chứng từ booking mới để làm bằng chứng.
7. **[Hệ thống] Tự động tái khớp lệnh:** Ngay sau khi NVT 2 lưu lại thay đổi, "bộ não" ghép lệnh của hệ thống sẽ chạy lại. Lần này, nó thấy rằng LGT-A và LLR-B đã **khớp 100%**.
8. **[Hệ thống]** Kịch bản bây giờ sẽ tự động chuyển thành **Kịch bản 1.3 (Khác NVT, Cùng Hãng tàu)**. Một "Giao dịch Đề xuất" được tạo ra và gửi đến LTA Admin để bắt đầu quy trình điều phối.

**7. Phản hồi hệ thống (System Feedback)**

- Giao diện hiển thị gợi ý phải cực kỳ rõ ràng, nêu bật được lợi ích (ví dụ: "Tiết kiệm ước tính: [số tiền]") và chỉ rõ hành động cần làm ("Cần booking với Maersk").
- Cung cấp một đường link trực tiếp từ gợi ý đến trang sửa "Lệnh Lấy Rỗng" để người dùng hành động nhanh chóng.
- Sau khi người dùng sửa lệnh, hệ thống nên có một Toast notification xác nhận: "Lệnh đã được cập nhật. Đang tìm kiếm lại các cơ hội ghép nối...".

**8. Ngoại lệ (Exception flows)**

- **NVT 2 không thể đổi booking:** Nếu họ không thể hủy hoặc booking mới có chi phí quá cao, họ có thể bỏ qua gợi ý. Hệ thống sẽ không làm gì thêm.
- **Cơ hội bị người khác "nẫng tay trên":** Trong lúc NVT 2 đang xử lý việc đổi booking, một NVT 3 khác có thể đã vào Marketplace và thực hiện ghép nối thành công với Lệnh Giao Trả của NVT 1. Khi NVT 2 quay lại, cơ hội đó đã không còn. Hệ thống cần hiển thị rõ trạng thái này.

**9. Luồng thay thế (Alternate Path)**

- NVT 2 có thể không cần đợi gợi ý từ hệ thống. Nếu là một người dùng có kinh nghiệm, họ có thể tự mình lướt Marketplace, thấy cơ hội tốt, và chủ động thực hiện việc đổi booking rồi quay lại hệ thống để tạo yêu cầu.

**10. Trạng thái sau cùng (Post-condition)**

- **Thành công:** "Lệnh Lấy Rỗng" của NVT 2 được cập nhật thành công. Một yêu cầu ghép nối chéo công ty hợp lệ được tạo ra và đi vào luồng phê duyệt của LTA Admin.
- **Thất bại/Bỏ qua:** Các lệnh vẫn giữ nguyên trạng thái ban đầu.

**11. Quy tắc nghiệp vụ (Business Rules)**

- Hệ thống không bao giờ tự ý thay đổi dữ liệu booking hoặc hãng tàu của người dùng. Vai trò của hệ thống là **gợi ý** và **cung cấp công cụ** để người dùng tự thực hiện thay đổi.
- Một "gợi ý" sẽ có thời gian tồn tại nhất định. Nếu sau khoảng thời gian đó mà người dùng không hành động, gợi ý sẽ tự động biến mất để tránh làm nhiễu giao diện.

![Editor _ Mermaid Chart-2025-06-24-035827.png](attachment:66bd57e9-c33a-4803-915b-0df86cb6b2aa:Editor___Mermaid_Chart-2025-06-24-035827.png)

## Không Đáp Ứng Điều Kiện Địa Điểm ##

# **Case 3.1: Kết hợp COD + Street-turn (Cùng NVT, Cùng Hãng tàu)**

**1. Tên kịch bản**

- Tạo Yêu cầu Kết hợp COD và Street-turn Nội bộ

**2. ID kịch bản**

- FEAT-COMBO-COD-ST-001A

**3. Mục tiêu (Business Goal)**

- Tự động phát hiện và đề xuất một giải pháp kết hợp cho các cơ hội street-turn nội bộ bị cản trở bởi khoảng cách địa lý, giúp NVT tối ưu hóa các lộ trình phức tạp và tiết kiệm chi phí tối đa.

**4. Vai trò tham gia (Actors)**

- **Thực hiện chính:** Điều phối viên (Dispatcher).
- **Phê duyệt:** Quản trị viên LTA (LTA Admin).
- **Ảnh hưởng:** Tài xế, Kế toán NVT.

**5. Bối cảnh (Pre-condition)**

- Dispatcher đã tạo một "Lệnh Giao Trả" (LGT) và một "Lệnh Lấy Rỗng" (LLR) trong hệ thống, cả hai đều thuộc cùng một NVT và cùng Hãng tàu.
- Cả hai lệnh đều ở trạng thái Sẵn sàng.
- Hai lệnh thỏa mãn điều kiện về **Loại Container** và **Thời gian**.
- Điều kiện về **Địa điểm KHÔNG thỏa mãn**: khoảng cách giữa điểm dỡ hàng của LGT và điểm đóng hàng của LLR lớn hơn ngưỡng street-turn trực tiếp (ví dụ: > 50km).
- Tuy nhiên, hệ thống xác định rằng có ít nhất một **Depot đối tác của LTA** nằm ở vị trí trung gian hợp lý, có thể làm điểm hẹn mới.

**6. Luồng chính (Happy Path)**

1. **[Hệ thống]** "Bộ não" ghép lệnh quét và phát hiện cơ hội kết hợp này.
2. **[Hệ thống]** Nó tính toán và xác định **Depot đối tác C** là điểm hẹn tối ưu nhất (dựa trên Phương án C bạn đã chọn).
3. **[Hệ thống]** Một gợi ý đặc biệt xuất hiện trên Dashboard của Dispatcher trong khu vực **"Cơ Hội Tối Ưu Nâng Cao"**:
    
    > "Gợi ý Kết hợp: Để ghép nối Lệnh [số cont] và [số booking], chúng tôi đề xuất bạn yêu cầu đổi nơi trả về Depot C. Kế hoạch này giúp bạn tiết kiệm [số tiền]."
    > 
4. **[Dispatcher]** Thấy gợi ý hợp lý, nhấn nút **"Tạo Yêu cầu Kết hợp"**.
5. **[Hệ thống]** Một "Yêu cầu Kết hợp" (COMBINED_REQUEST) duy nhất được tạo với trạng thái Chờ duyệt. Yêu cầu này đóng gói thông tin của cả hai nghiệp vụ (COD đến Depot C và Street-turn từ Depot C).
6. **[Hệ thống]** Các lệnh LGT và LLR liên quan bị khóa lại với trạng thái Chờ duyệt kết hợp.
7. **[LTA Admin]** Trên Admin Dashboard, nhận được yêu cầu kết hợp này. Giao diện hiển thị rõ ràng kế hoạch đề xuất.
8. **[LTA Admin]** Xem xét toàn bộ kế hoạch và nhấn **"Phê duyệt Kế hoạch"**.
9. **[Hệ thống]** Gửi thông báo thành công cho Dispatcher.

**7. Phản hồi hệ thống (System Feedback)**

- **Sau bước 3:** Hiển thị thẻ gợi ý kết hợp một cách trực quan trên giao diện.
- **Sau bước 5:** Hiển thị Toast: "Đã gửi Yêu cầu Kết hợp thành công!". Cập nhật trạng thái các lệnh liên quan.
- **Sau bước 9:**
    - Hiển thị Toast real-time: "Kế hoạch tối ưu hóa của bạn đã được phê duyệt!".
    - Trạng thái của "Yêu cầu Kết hợp" đổi thành Đã duyệt.
    - Hệ thống tự động cập nhật "Lệnh Giao Trả" với nơi trả mới là Depot C và đổi trạng thái của cả LGT và LLR thành Đã ghép.

**8. Ngoại lệ (Exception flows)**

- **LTA Admin từ chối Kế hoạch:** Yêu cầu Kết hợp bị đổi trạng thái thành Từ chối. Các lệnh LGT và LLR được rollback về trạng thái Sẵn sàng để Dispatcher tìm phương án khác.
- **Hủy bởi Dispatcher:** Dispatcher có thể hủy "Yêu cầu Kết hợp" khi nó đang ở trạng thái Chờ duyệt.
- **Không tìm thấy Depot trung gian phù hợp:** Nếu hệ thống không tìm thấy depot đối tác nào của LTA có vị trí hợp lý, gợi ý kết hợp sẽ không được hiển thị.

**9. Luồng thay thế (Alternate Path)**

- Dispatcher có thể tự mình thực hiện quy trình này một cách thủ công: tự tạo một yêu cầu COD trước, chờ được duyệt, sau đó mới tạo một yêu cầu Street-turn. Luồng "Yêu cầu Kết hợp" chỉ là một "lối tắt" thông minh để gộp hai bước thành một.

**10. Trạng thái sau cùng (Post-condition)**

- **Thành công:** Một Yêu cầu Kết hợp được duyệt. Lệnh Giao Trả được cập nhật nơi trả mới. Cả Lệnh Giao Trả và Lệnh Lấy Rỗng đều được đánh dấu là đã ghép nối thành công. Dispatcher có thể điều phối tài xế theo một lộ trình đã được tối ưu hóa hoàn toàn.
- **Thất bại:** Các lệnh quay về trạng thái ban đầu, sẵn sàng cho các cơ hội khác.

**11. Quy tắc nghiệp vụ (Business Rules)**

- **Tất cả hoặc không có gì:** LTA Admin chỉ có thể phê duyệt hoặc từ chối toàn bộ "Yêu cầu Kết hợp". Không có phê duyệt một phần.
- **Ưu tiên Depot đối tác:** Logic lựa chọn depot trung gian của hệ thống sẽ ưu tiên các depot nằm trong danh sách đối tác của LTA để đảm bảo chất lượng dịch vụ và tối ưu chi phí.
- Một khi "Yêu cầu Kết hợp" được gửi đi, các lệnh con (LGT, LLR) sẽ bị khóa lại.

![Editor _ Mermaid Chart-2025-06-24-044437.png](attachment:fe348f1d-c28a-4e32-a3ed-e45933da09ca:Editor___Mermaid_Chart-2025-06-24-044437.png)

---

# **Case 3.2: Kết hợp COD + Street-turn (Khác NVT, Cùng Hãng tàu)**

**1. Tên kịch bản**

- Điều phối Giao dịch Kết hợp COD và Street-turn trên Marketplace (LTA-Mediated Combined COD & Street-turn)

**2. ID kịch bản**

- FEAT-COMBO-COD-ST-001B

**3. Mục tiêu (Business Goal)**

- Mở khóa các cơ hội ghép nối chéo công ty có giá trị cao nhưng bị cản trở bởi khoảng cách địa lý.
- Khẳng định vai trò trung gian của LTA trong việc điều phối các giao dịch phức tạp, tạo ra một lợi thế cạnh tranh độc nhất cho nền tảng.
- Tối đa hóa doanh thu cho các bên: NVT 1 (có LGT) có thể nhận được cước vận chuyển, NVT 2 (có LLR) tiết kiệm chi phí, LTA thu được phí dịch vụ.

**4. Vai trò tham gia (Actors)**

- **Người được đề nghị (Executor):** Điều phối viên của Công ty Vận tải 1 (NVT 1) - bên có "Lệnh Giao Trả".
- **Người hưởng lợi (Beneficiary):** Điều phối viên của Công ty Vận tải 2 (NVT 2) - bên có "Lệnh Lấy Rỗng".
- **Nhà Điều Phối (Orchestrator):** Quản trị viên LTA (LTA Admin).

**5. Bối cảnh (Pre-condition)**

- NVT 1 đã "chào bán" một "Lệnh Giao Trả" (LGT-A) của hãng tàu Maersk lên Marketplace, trạng thái Sẵn sàng.
- NVT 2 đã tạo một "Lệnh Lấy Rỗng" (LLR-B) yêu cầu container Maersk, trạng thái Sẵn sàng.
- Hai lệnh này thỏa mãn điều kiện về **Loại Container** và **Thời gian**.
- Điều kiện về **Địa điểm KHÔNG thỏa mãn**: khoảng cách giữa điểm dỡ hàng của LGT-A và điểm đóng hàng của LLR-B là quá xa.
- Hệ thống xác định được một **Depot đối tác C của LTA** có vị trí trung gian tối ưu có thể kết nối hai lệnh này.

**6. Luồng chính (Happy Path)**

1. **[Hệ thống]** "Bộ não" ghép lệnh quét và phát hiện cơ hội kết hợp phức hợp này giữa hai công ty khác nhau.
2. **[Hệ thống]** Thay vì gửi gợi ý cho người dùng, hệ thống tạo ra một **"Giao dịch Tiềm năng"** và đưa nó vào một hàng chờ đặc biệt trên **Admin Dashboard** của LTA Admin.
3. **[LTA Admin]** Trên dashboard, trong mục "Cơ hội Tối ưu hóa", Admin thấy một đề xuất mới: "Ghép nối LGT [của NVT 1] và LLR [của NVT 2] bằng cách thực hiện COD về Depot C."
4. **[LTA Admin]** Admin xem xét chi tiết, thấy kế hoạch khả thi. Admin nhấn nút **"Bắt đầu Điều phối"**.
5. **[Hệ thống & LTA Admin]** Bắt đầu một quy trình phê duyệt tuần tự (sequential approval):
    - **Bước 5a (Gửi đề nghị cho NVT 1):** Hệ thống gửi một "Đề nghị" đến NVT 1: *"Bạn có một cơ hội tối ưu hóa. Bạn có đồng ý thực hiện (1) Đổi nơi trả container [số cont] về Depot C, và sau đó (2) Thực hiện street-turn giao container này cho một đối tác khác không? Cước phí ước tính cho phần việc này là [số tiền]."*
6. **[NVT 1 - Dispatcher]** Nhận được đề nghị, xem xét lợi ích và nhấn **"Chấp thuận Đề nghị"**.
7. **[Hệ thống]** Ngay sau khi NVT 1 chấp thuận, hệ thống ghi nhận sự đồng ý này. **Yêu cầu bây giờ được coi là đã được xác nhận và có thể thực thi**.
8. **[LTA Admin]** Nhận được thông báo rằng NVT 1 đã đồng ý. Admin nhấn nút cuối cùng: **"Xác nhận & Khóa Giao dịch"**.
9. **[Hệ thống]** Giao dịch được xác nhận.
    - Trạng thái của LGT-A và LLR-B được cập nhật thành Đã ghép.
    - Thông báo thành công được gửi đến cả NVT 1 và NVT 2. NVT 1 nhận được lộ trình chi tiết mới. NVT 2 được thông báo nhu cầu của họ đã được xử lý.
    - Các giao dịch tài chính (phí dịch vụ, cước vận chuyển) được tự động tạo ra.

**7. Phản hồi hệ thống**

- Một giao diện đặc biệt trên Admin Dashboard để quản lý và điều phối các "Giao dịch Tiềm năng".
- Giao diện cho NVT 1 để nhận và phản hồi các "Đề nghị" từ LTA.
- Hệ thống thông báo real-time để cập nhật trạng thái cho tất cả các bên ở mỗi bước.

**8. Ngoại lệ (Exception flows)**

- **NVT 1 từ chối đề nghị:** Toàn bộ giao dịch tiềm năng bị hủy. LTA Admin nhận được thông báo. Các lệnh LGT-A và LLR-B quay về trạng thái Sẵn sàng để hệ thống tìm cơ hội khác.
- **LTA Admin quyết định không điều phối:** Nếu Admin thấy kế hoạch quá rủi ro hoặc không khả thi, họ có thể hủy "Giao dịch Tiềm năng" ngay từ đầu.
- **Hết thời gian phản hồi:** Nếu NVT 1 không trả lời đề nghị trong một khoảng thời gian nhất định, đề nghị sẽ tự động hết hạn.

**9. Luồng thay thế (Alternate Path)**

- Không có luồng thay thế trực tiếp cho một kịch bản phức tạp như thế này. Nếu không có sự điều phối của LTA, cơ hội này gần như chắc chắn sẽ bị bỏ lỡ.

**10. Trạng thái sau cùng (Post-condition)**

- **Thành công:** Một giao dịch kết hợp phức tạp được thực hiện. NVT 1 có doanh thu. NVT 2 được đáp ứng nhu cầu. LTA có doanh thu. Một kịch bản "win-win-win" được tạo ra.
- **Thất bại:** Các lệnh quay về trạng thái ban đầu.

**11. Quy tắc nghiệp vụ (Business Rules)**

- **LTA là trung tâm:** Toàn bộ quy trình điều phối và giao tiếp phải đi qua LTA Admin.
- **Bảo mật thông tin:** NVT 1 và NVT 2 không biết thông tin chi tiết của nhau cho đến khi giao dịch được xác nhận (và kể cả sau đó, thông tin có thể được giới hạn).
- **Phê duyệt tuần tự:** Sự đồng ý của NVT 1 là điều kiện tiên quyết để LTA Admin có thể khóa giao dịch cuối cùng.
- **Ưu tiên Depot đối tác:** Lựa chọn depot trung gian vẫn ưu tiên các depot trong mạng lưới của LTA.

![Editor _ Mermaid Chart-2025-06-24-045606.png](attachment:5ee1b88c-08eb-4cdd-9783-aa67012838c6:Editor___Mermaid_Chart-2025-06-24-045606.png)

## Không Đáp ứng Điều Kiện Thời gian ##

# **CÙNG NVT & CÙNG HÃNG TÀU**

**1. Tên kịch bản**

- Sử dụng Dịch vụ Lưu trữ Trung gian để Kích hoạt Street-turn (Staging & Storage Service for Delayed Street-turn)

**2. ID kịch bản**

- FEAT-STAGING-SERVICE-001

**3. Mục tiêu (Business Goal)**

- Cung cấp các lựa chọn lưu trữ container linh hoạt và tiết kiệm chi phí (so với quy trình chuẩn) cho các NVT khi có độ trễ về thời gian trong một cơ hội street-turn.
- Tạo ra nguồn doanh thu mới cho LTA/GPG từ dịch vụ lưu bãi và hoa hồng từ việc giới thiệu depot đối tác.

**4. Vai trò tham gia (Actors)**

- **Thực hiện chính:** Điều phối viên (Dispatcher).
- **Phê duyệt & Điều phối:** Quản trị viên LTA (LTA Admin).

**5. Bối cảnh (Pre-condition)**

- Hệ thống tìm thấy một cặp "Lệnh Giao Trả" (LGT) và "Lệnh Lấy Rỗng" (LLR) tiềm năng.
- Cặp này thỏa mãn các điều kiện về **Loại Container, Hãng Tàu, và Địa điểm**.
- Điều kiện về **Thời gian KHÔNG thỏa mãn**: Thời gian cần container của LLR diễn ra quá xa sau thời gian container của LGT sẵn sàng (ví dụ: > 24-48 giờ).

---

## **Luồng Chính (Happy Path): Hệ Thống Gợi Ý Các Giải Pháp Lưu Trữ**

1. **[Hệ thống]** Phát hiện cặp ghép nối bị lỡ nhịp về thời gian.
2. **[Hệ thống]** Thay vì chỉ một gợi ý, hệ thống sẽ hiển thị một khu vực **"Đề xuất Giải pháp cho Thời gian chờ"** với hai lựa chọn rõ ràng:
    
    **Lựa chọn A: "Gửi vào Bãi GPG (Tiết kiệm Phí Nâng/Hạ)"**
    
    - **Mô tả gợi ý:** "Bạn có thể tạm thời gửi cả xe và container về **Bãi GPG [tên bãi gần nhất]**. Lựa chọn này giúp bạn **không tốn chi phí nâng/hạ** tại depot. Phí lưu bãi ước tính: [số tiền/ngày]."
    - **Nút hành động:** **"Yêu cầu gửi vào Bãi GPG"**.
    
    **Lựa chọn B: "Gửi về Depot Đối tác (Tối ưu Chi phí)"**
    
    - **Mô tả gợi ý:** "Chúng tôi đề xuất bạn yêu cầu Đổi Nơi Trả (COD) về **Depot đối tác [tên depot rẻ nhất]**. Lựa chọn này có chi phí nâng/hạ và phí COD tốt hơn so với depot mặc định của bạn."
    - **Nút hành động:** **"Yêu cầu COD về Depot Đối tác"**.
3. **[Dispatcher]** Anna xem xét hai lựa chọn, so sánh chi phí và quyết định. Hãy xem xét cả hai kịch bản con:

## **Case 4.1: Cùng NVT & Lựa chọn Gửi vào Bãi GPG (Sub-case A)**

- **Tình huống:** Anna quyết định rằng việc không phải tốn phí nâng hạ là lựa chọn tốt nhất.
- **Luồng:**
    1. **[Dispatcher]** Nhấn nút **"Yêu cầu gửi vào Bãi GPG"**.
    2. **[Hệ thống]** Một Yêu cầu COD được tạo, với điểm đến là "Bãi GPG". Trạng thái của LGT gốc được khóa lại.
    3. **[LTA Admin]** Nhận và phê duyệt yêu cầu này (dựa trên tình trạng chỗ trống tại bãi).
    4. **[Dispatcher]** Sau khi được duyệt, điều phối tài xế đưa cả xe (đầu kéo + rơ-moóc + container rỗng) đến Bãi GPG.
    5. **[Hệ thống]** Container được ghi nhận đã vào bãi. Trạng thái của LGT đổi thành **Đang lưu trữ tại Bãi GPG (STAGING_AT_GPG)**. Hệ thống bắt đầu tính phí lưu bãi. Bên chịu phí là NVT đã gửi.
    6. **[Hệ thống]** Khi đến gần thời gian của LLR, hệ thống gửi thông báo nhắc nhở cho Dispatcher.
    7. **[Dispatcher]** Điều phối tài xế (có thể là người cũ hoặc người mới) đến Bãi GPG để nhận lại xe và container, sau đó đi thực hiện LLR.
    8. **Kết thúc.**

## **Case 4.2: Cùng NVT & Lựa chọn Gửi về Depot Đối tác (Sub-case B)**

- **Tình huống:** Anna thấy rằng depot đối tác có vị trí thuận lợi hơn.
- **Luồng:**
    1. **[Dispatcher]** Nhấn nút **"Yêu cầu COD về Depot Đối tác"**.
    2. **[Hệ thống]** Một Yêu cầu COD được tạo như bình thường, với điểm đến là Depot đối tác do LTA đề xuất.
    3. **[LTA Admin]** Nhận và phê duyệt yêu cầu COD này.
    4. **[Dispatcher]** Điều phối tài xế trả container về Depot đối tác đó.
    5. **[Hệ thống]** Khi LGT được xác nhận đã hoàn tất tại depot mới, **nó sẽ quay trở lại trạng thái Sẵn sàng** với vị trí đã được cập nhật.
    6. **[Hệ thống]** Lúc này, hệ thống sẽ tiếp tục tìm kiếm và gợi ý các cơ hội street-turn từ depot mới này. Vì LLR vẫn còn đó, một gợi ý street-turn "tại depot" (Case 1.1B) có thể sẽ xuất hiện.
    7. **Kết thúc.**

![Editor _ Mermaid Chart-2025-06-24-084320.png](attachment:a6aa81fb-b308-4129-b722-7118a47d4a7e:Editor___Mermaid_Chart-2025-06-24-084320.png)

---

## **Case 4.3 (Khác NVT)**

### **1. Tên kịch bản**

- Điều phối Lưu trữ Trung gian cho Giao dịch Street-turn trên Marketplace

### **2. ID kịch bản**

- FEAT-STAGING-MKT-001

### **3. Mục tiêu (Business Goal)**

- Kết nối một cơ hội giao trả và một nhu cầu lấy rỗng giữa hai công ty khác nhau khi chúng bị lệch pha về thời gian.
- Tăng tối đa thanh khoản và số lượng giao dịch thành công trên Marketplace.
- Củng cố vai trò của LTA Admin như một nhà điều phối trung tâm, tạo ra giá trị cho cả hai bên và doanh thu cho nền tảng.

### **4. Vai trò tham gia (Actors)**

- **Người đóng góp Container (Container Provider):** Điều phối viên của Công ty Vận tải 1 (NVT 1).
- **Người có Nhu cầu (Demand Owner):** Điều phối viên của Công ty Vận tải 2 (NVT 2).
- **Nhà Điều Phối (Orchestrator):** Quản trị viên LTA (LTA Admin).

### **5. Bối cảnh (Pre-condition)**

- NVT 1 đã "chào bán" một "Lệnh Giao Trả" (LGT-A) lên Marketplace, trạng thái Sẵn sàng.
- NVT 2 đã tạo một "Lệnh Lấy Rỗng" (LLR-B), trạng thái Sẵn sàng.
- Hai lệnh thỏa mãn điều kiện về **Loại Container, Hãng Tàu, và Địa điểm**.
- Điều kiện về **Thời gian KHÔNG thỏa mãn** (thời gian chờ > 48 giờ).

### **6. Luồng chính (Happy Path)**

1. **[Hệ thống]** Phát hiện cơ hội ghép nối chéo công ty nhưng bị lỡ nhịp thời gian.
2. **[Hệ thống]** Tạo một **"Giao dịch Lưu trữ Tiềm năng"** và gửi nó vào hàng chờ của **LTA Admin**.
3. **[LTA Admin]** Trên dashboard, Admin thấy một đề xuất mới: "Đề xuất cho NVT 1 lưu trữ container [số cont] tại [Bãi GPG/Depot Đối tác được gợi ý] để phục vụ cho nhu cầu của NVT 2."
4. **[LTA Admin]** Nhấn nút **"Bắt đầu Điều phối"**.
5. **[Hệ thống]** Gửi một **"Đề nghị Lưu trữ & Hợp tác"** đến NVT 1:
    
    > "Chúng tôi có một đối tác muốn tái sử dụng container [số cont] của bạn, nhưng họ cần nó sau [số] ngày. Bạn có đồng ý gửi container này về [Bãi GPG/Depot Đối tác] để lưu trữ chờ giao dịch không? Chi phí lưu bãi dự kiến là [số tiền], do bạn chi trả. Nếu giao dịch thành công, bạn có thể nhận được một khoản phí hỗ trợ/cước vận tải từ LTA."
    > 
6. **[NVT 1 - Dispatcher]** Nhận đề nghị, cân nhắc chi phí và lợi ích, sau đó nhấn **"Chấp thuận Lưu trữ"**.
7. **[LTA Admin]** Nhận được thông báo NVT 1 đã đồng ý. LTA Admin phê duyệt yêu cầu gửi vào bãi.
8. **[NVT 1 - Dispatcher]** Điều phối tài xế đưa container đến địa điểm lưu trữ trung gian.
9. **[Hệ thống]** Container được ghi nhận đã vào bãi, trạng thái STAGING. Yêu cầu ghép nối với LLR-B của NVT 2 được "khóa" lại.
10. **[Hệ thống]** Khi đến gần thời gian của LLR-B, hệ thống gửi thông báo cho LTA Admin.
11. **[LTA Admin]** Bắt đầu luồng "Bán Lệnh": tìm một NVT (có thể là chính NVT 1 hoặc NVT C khác) để đến bãi lấy container và thực hiện nốt công việc cho NVT 2.
12. **[Hệ thống]** Sau khi hoàn tất, các giao dịch tài chính (phí lưu bãi, phí dịch vụ, cước vận chuyển) được quyết toán.

![Editor _ Mermaid Chart-2025-06-24-084655.png](attachment:3f10598a-683c-4234-900a-be6e06ea6177:Editor___Mermaid_Chart-2025-06-24-084655.png)

---

# **Các Vấn Đề Liên Quan**

- **Luồng thay thế (Alternate Path):** Dispatcher có toàn quyền từ chối các gợi ý của hệ thống và tiếp tục quy trình trả rỗng về depot mặc định của họ.
- **Trạng thái sau cùng (Post-condition):**
    - **Thành công:** Một cơ hội street-turn tưởng chừng đã mất được "cứu sống". NVT tiết kiệm được chi phí so với quy trình chuẩn. LTA có doanh thu từ các dịch vụ lưu trữ.
- **Quy tắc nghiệp vụ (Business Rules):**
    - **Bảng giá dịch vụ:** LTA Admin phải có một khu vực để cấu hình bảng giá phí lưu bãi tại các Bãi GPG và các khoản hoa hồng/chiết khấu với các Depot đối tác.
    - **Minh bạch chi phí:** Giao diện gợi ý phải hiển thị rõ ràng và chi tiết các chi phí dự kiến cho người dùng trước khi họ đưa ra quyết định.
    - **Bên chịu phí:** Như bạn đã xác nhận, NVT là bên trực tiếp sử dụng và hưởng lợi từ dịch vụ lưu trữ trung gian, do đó họ sẽ là người chịu phí lưu bãi.

## Không Đáp ứng Điều Kiện Chất lượng ##

**1. Tên kịch bản**

- Xử lý Chất lượng Container và Dịch vụ Giá trị Gia tăng (VAS) cho Giao dịch Street-turn

**2. ID kịch bản**

- FEAT-QUALITY-VAS-001

**3. Mục tiêu (Business Goal)**

- Đảm bảo các giao dịch street-turn diễn ra suôn sẻ bằng cách khớp nối không chỉ về logic (loại cont, địa điểm) mà cả về chất lượng vật lý của container.
- Cung cấp một giải pháp minh bạch và công bằng để xử lý các vấn đề về chất lượng (vệ sinh, sửa chữa), giảm thiểu rủi ro và tranh chấp.
- Tạo nguồn doanh thu mới cho LTA từ các dịch vụ giá trị gia tăng (VAS).

**4. Vai trò tham gia (Actors)**

- **Dispatcher (Bên Giao Trả - NVT 1):** Người khai báo tình trạng container ban đầu.
- **Dispatcher (Bên Lấy Rỗng - NVT 2):** Người đưa ra yêu cầu về chất lượng.
- **LTA Admin:** Người kiểm duyệt thông tin, điều phối dịch vụ và giải quyết tranh chấp.

**5. Bối cảnh (Pre-condition)**

- Hệ thống tìm thấy một cặp LGT và LLR tiềm năng, thỏa mãn mọi điều kiện về Loại cont, Hãng tàu, Địa điểm, Thời gian.
- **[NVT 2]** Trong "Lệnh Lấy Rỗng" của mình, đã chỉ định yêu cầu chất lượng tối thiểu (ví dụ: Tiêu chuẩn thực phẩm - Sạch, không mùi).

---

### **Luồng Nghiệp Vụ Chính (Happy Path & Các Nhánh Rẽ)**

**Bước 1: Khai Báo và Tạo Yêu Cầu**

1. **[NVT 1 - Dispatcher]** Khi tạo/sửa LGT, anh ấy khai báo tình trạng container trong một mục "Tình trạng & Chất lượng":
    - **Dropdown lựa chọn:** Như mới, Tốt, Cần vệ sinh cơ bản, Dính mùi nặng, Sàn hỏng nhẹ...
    - **Ô ghi chú tự do:** "Sàn có vài vết xước".
    - **Upload hình ảnh (Bắt buộc khi tạo yêu cầu street-turn):** Chụp 6 mặt của container (trong, ngoài, nóc, sàn, cửa).
2. **[NVT 1 - Dispatcher]** Tìm thấy một cơ hội street-turn (với LLR của NVT 2) và nhấn **"Tạo Yêu cầu"**.

**Bước 2: Hệ Thống Sơ Lọc và Đề Xuất Giải Pháp**

1. **[Hệ thống]** Nhận được yêu cầu. Nó so sánh Tình trạng khai báo của LGT-A với Yêu cầu chất lượng của LLR-B.
2. **Ngã rẽ logic:**
    - **Case A: Chất lượng Khớp (Happy Path):** Nếu NVT 1 khai báo là Sạch và NVT 2 cũng chỉ cần Tiêu chuẩn thường.
        - Yêu cầu được chuyển thẳng đến LTA Admin để duyệt như bình thường.
    - **Case B: Chất lượng KHÔNG Khớp (Cần Dịch vụ):** Nếu NVT 1 khai báo là Cần vệ sinh cơ bản và NVT 2 yêu cầu Tiêu chuẩn thực phẩm.
        - Hệ thống sẽ **tạm dừng** yêu cầu và gửi lại một **"Đề xuất Kế hoạch Xử lý"** cho **NVT 1 (bên có container bẩn)**.

**Bước 3: Luồng Xử Lý Chất Lượng (Khi Không Khớp)**

1. **[NVT 1 - Dispatcher]** Nhận được thông báo từ hệ thống:
    
    > "Để thực hiện giao dịch này, container của bạn cần được xử lý để đáp ứng yêu cầu của đối tác. Vui lòng chọn một trong các phương án sau:"
    > 
2. **Giao diện đề xuất của hệ thống:**
    - **Phương án 1: "Sử dụng Dịch vụ của LTA (Đề xuất)"**
        - **Mô tả:** "Đưa container về Bãi LTA để chúng tôi thực hiện **Vệ sinh Tiêu chuẩn Thực phẩm**. Chi phí ước tính: [Báo giá dựa trên bảng giá cố định]."
        - **Nút:** "Chọn & Gửi lại Yêu cầu".
    - **Phương án 2: "Tự xử lý tại Depot"**
        - **Mô tả:** "Thực hiện COD để đưa container về một depot đối tác của LTA và tự thực hiện dịch vụ tại đó. Phí COD ước tính: [báo giá]."
        - **Nút:** "Chọn & Yêu cầu COD".
3. **[NVT 1 - Dispatcher]** Lựa chọn phương án và xác nhận. Chi phí sẽ được tính cho NVT 1.
4. **[Hệ thống]** Một "Yêu cầu Kết hợp" mới (ví dụ: Street-turn + VAS) được tạo ra và gửi đến LTA Admin để duyệt toàn bộ kế hoạch.

**Bước 4: Luồng Giải Quyết Rủi Ro (Khi Khai báo không chính xác)**

Đây là giải pháp đề xuất cho "nỗi đau" bạn đã nêu.

1. **Bối cảnh:** LTA Admin đã duyệt một yêu cầu street-turn dựa trên khai báo "sạch" của NVT 1. Tài xế của NVT 1 giao container cho tài xế của NVT 2.
2. **[NVT 2 - Tài xế/Dispatcher]** Khi nhận container, họ phát hiện container thực tế bị bẩn và dính mùi, không đúng như khai báo.
3. **Hành động của NVT 2:**
    - Trên trang chi tiết của yêu cầu street-turn (đang ở trạng thái Đã duyệt), một nút **"Báo cáo Sự cố"** sẽ luôn có sẵn.
    - Dispatcher của NVT 2 nhấn vào nút này.
4. **Form Báo cáo Sự cố:**
    - **Loại sự cố:** Dropdown (Tình trạng container không đúng, Tài xế đến trễ...). Chọn "Tình trạng container không đúng".
    - **Mô tả chi tiết:** "Container có mùi hóa chất nồng nặc".
    - **Bằng chứng:** **Bắt buộc upload hình ảnh/video** về tình trạng thực tế.
5. **Hành động của hệ thống:**
    - Trạng thái của yêu cầu street-turn ngay lập tức được chuyển thành **Đang Tranh chấp (IN_DISPUTE)** - có màu đỏ và được đưa lên đầu danh sách quản lý của LTA Admin.
    - Gửi thông báo khẩn cho cả NVT 1, NVT 2 và LTA Admin.
6. **Luồng Giải quyết của LTA Admin:**
    - LTA Admin vào xem chi tiết tranh chấp, so sánh hình ảnh khai báo của NVT 1 và hình ảnh báo cáo của NVT 2.
    - LTA Admin liên hệ với các bên và ra quyết định xử lý trên hệ thống:
        - **Quyết định 1: "Lỗi thuộc về NVT 1"**: Admin có thể áp dụng một khoản "phạt" vi phạm cam kết chất lượng cho NVT 1 và đề xuất các phương án tiếp theo (hủy giao dịch, hoặc NVT 2 mang đi vệ sinh và NVT 1 chịu chi phí).
        - **Quyết định 2: "Báo cáo không hợp lệ"**: Bác bỏ báo cáo và chuyển trạng thái yêu cầu về lại Đã duyệt.
7. **Kết quả:** Quy trình này tạo ra một cơ chế **răn đe** (ngăn chặn khai báo sai) và **giải quyết** (khi có sự cố), bảo vệ quyền lợi cho bên nhận và tăng cường sự tin cậy vào nền tảng.

**Quy tắc nghiệp vụ:**

- Hệ thống phải lưu trữ tất cả hình ảnh, khai báo, báo cáo như một phần của Audit Log để làm bằng chứng.
- Điểm uy tín của một NVT có thể bị trừ nếu có nhiều lần bị báo cáo vi phạm chất lượng.

![Editor _ Mermaid Chart-2025-06-24-085359.png](attachment:e94bef16-648e-4303-876a-af054b0efada:Editor___Mermaid_Chart-2025-06-24-085359.png)

## Ma Trận Xử Lý Các Kịch Bản Lồng Chéo Phức Tạp ##

**Mục tiêu:** Hướng dẫn Điều phối viên (Dispatcher) nên ưu tiên thực hiện hành động nào khi một cơ hội tiềm năng gặp phải **nhiều hơn một** rào cản.

**Các biến số chính:**

- **NVT:** Cùng NVT / Khác NVT
- **Hãng Tàu (HT):** Cùng HT / Khác HT
- **Địa Điểm (ĐĐ):** Phù hợp / Không phù hợp (quá xa)
- **Thời Gian (TG):** Phù hợp / Không phù hợp (chờ quá lâu)
- **Chất Lượng (CL):** Phù hợp / Không phù hợp (cần xử lý)

**Ma trận dưới đây sẽ giả định cặp ghép nối đã khớp về Loại Container.**

| **Tình huống (Kết hợp các vấn đề)** | **Phân tích Rào cản Chính** | **Giải pháp Ưu tiên & Luồng hành động của Dispatcher** |
| --- | --- | --- |
| **Cùng NVT, Cùng HT** + ❌ **ĐĐ không phù hợp** | Khoảng cách là rào cản duy nhất. | **Ưu tiên: Kết hợp COD + Street-turn.** 1. Hệ thống sẽ tự động gợi ý "Yêu cầu Kết hợp".2. Dispatcher nhấn nút để gửi yêu cầu "tất cả trong một" đến LTA Admin. |
| **Cùng NVT, Cùng HT** + ❌ **TG không phù hợp** | Thời gian chờ là rào cản duy nhất. | **Ưu tiên: Sử dụng Dịch vụ Lưu trữ.**1. Hệ thống sẽ gợi ý 2 lựa chọn: "Gửi vào Bãi GPG" hoặc "Gửi về Depot đối tác".2. Dispatcher chọn phương án có chi phí tối ưu và tạo yêu cầu tương ứng. |
| **Cùng NVT, Cùng HT** + ❌ **CL không phù hợp** | Chất lượng là rào cản duy nhất. | **Ưu tiên: Sử dụng Dịch vụ Giá trị Gia tăng (VAS).**1. Hệ thống gợi ý kết hợp "Street-turn + Dịch vụ Vệ sinh/Sửa chữa".2. Dispatcher (bên có cont bẩn) chấp nhận chi phí và gửi yêu cầu kết hợp. |
| **Cùng NVT, Cùng HT** + ❌ **ĐĐ không phù hợp** + ❌ **TG không phù hợp** | Vừa xa, vừa phải chờ. Rất phức tạp. | **Ưu tiên: Xử lý vấn đề Thời Gian trước.**1. Hệ thống sẽ ưu tiên gợi ý **"Gửi vào Bãi GPG"**. Vì khi container đã nằm ở bãi chờ, nó có thể phục vụ cho bất kỳ nhu cầu nào khác, không chỉ nhu cầu ban đầu.2. **Sau khi** đã giải quyết được vấn đề thời gian, nếu nhu cầu ban đầu vẫn còn, hệ thống có thể tiếp tục gợi ý một chuyến xe từ bãi đến điểm đóng hàng. |
| **Cùng NVT, Cùng HT** + ❌ **ĐĐ không phù hợp** + ❌ **CL không phù hợp** | Vừa xa, vừa bẩn. | **Ưu tiên: Kết hợp COD + Dịch vụ tại Bãi LTA.**1. Hệ thống sẽ gợi ý một kế hoạch hoàn chỉnh: "Đề xuất yêu cầu COD để đưa container về **Bãi LTA** và thực hiện **Dịch vụ Vệ sinh** tại đây trước khi thực hiện street-turn."2. Dispatcher tạo một "Yêu cầu Kết hợp 3 trong 1" để LTA Admin duyệt. |
| ❌ **Khác NVT, Cùng HT** + ❌ **ĐĐ không phù hợp** | Rào cản kép: đối tác và khoảng cách. | **Ưu tiên: Giải quyết vấn đề đối tác trước thông qua LTA.**1. Hệ thống sẽ phát hiện cơ hội này và tạo "Giao dịch Tiềm năng" cho **LTA Admin**. 2. Trong đề xuất gửi đến NVT 1, LTA Admin sẽ nêu rõ kế hoạch: "Thực hiện COD về Depot C **VÀ** giao cho một đối tác khác." NVT 1 sẽ chấp thuận toàn bộ kế hoạch. |
| ❌ **Khác HT** + (Bất kỳ vấn đề nào khác) | **Hãng tàu là rào cản lớn nhất.** | **Ưu tiên tuyệt đối: Xử lý vấn đề Hãng Tàu trước.**1. Hệ thống sẽ **luôn luôn** ưu tiên hiển thị gợi ý: **"Để tận dụng cơ hội này, trước hết bạn cần có một booking phù hợp với hãng tàu [Tên hãng tàu]."**2. Chỉ **sau khi** Dispatcher đã tự mình vào "Lệnh Lấy Rỗng" và sửa lại hãng tàu cho khớp, hệ thống mới bắt đầu phân tích các rào cản tiếp theo (về địa điểm, thời gian, chất lượng) và đưa ra các gợi ý tương ứng như các case ở trên. |

![Editor _ Mermaid Chart-2025-06-24-090019.png](attachment:f906ab10-fa6d-4e80-aa94-733b63869aac:Editor___Mermaid_Chart-2025-06-24-090019.png)

Build bộ filter core để đánh giá thang điểm ưu tiên của các ghép cặp:

- Trọng số: chi phí tiết kiệm được
- Ghép mix các cases xử lý
- Đánh điểm ưu tiên cho các lệnh ghép nối

## Xử Lý Container Tồn Đọng tại Depot ##

# **Case 5.1: Tồn đọng do Cao điểm (Peak Season)**

**1. Tên kịch bản**

- Quản lý Container Tồn đọng trong Mùa Cao điểm (Peak Season Container Management)

**2. ID kịch bản**

- FEAT-DEPOT-MGMT-001

**3. Mục tiêu (Business Goal)**

- Tối ưu hóa việc quản lý container trong mùa cao điểm khi depot thường xuyên quá tải
- Cung cấp cơ chế ưu tiên và phân bổ container hiệu quả
- Tích hợp với hệ thống dự báo để chuẩn bị trước cho các tình huống cao điểm

**4. Vai trò tham gia (Actors)**

- **Thực hiện chính:** Quản lý Depot
- **Điều phối:** Quản trị viên LTA (LTA Admin)
- **Ảnh hưởng:** Dispatcher các NVT, Hãng tàu

**5. Bối cảnh (Pre-condition)**

- Depot đang trong tình trạng quá tải (sử dụng > 80% công suất)
- Có nhiều container về depot liên tục
- Có dự báo về nhu cầu container trong 7 ngày tới
- Hệ thống có khả năng theo dõi thời gian lưu container tại depot

**6. Luồng chính (Happy Path)**

1. **[Hệ thống]** Phát hiện depot đang trong tình trạng cao điểm dựa trên các chỉ số:
   - Tỷ lệ sử dụng không gian > 80%
   - Số lượng container nhập/xuất tăng đột biến
   - Thời gian chờ xử lý tăng cao

2. **[Hệ thống]** Kích hoạt chế độ "Quản lý Cao điểm":
   - Tự động phân loại container theo mức độ ưu tiên
   - Áp dụng các quy tắc xếp chồng thông minh
   - Tối ưu hóa không gian lưu trữ

3. **[LTA Admin]** Nhận thông báo về tình trạng cao điểm và xem xét các đề xuất từ hệ thống:
   - Danh sách container cần được ưu tiên xử lý
   - Các cơ hội street-turn tiềm năng để giảm tải
   - Đề xuất sử dụng depot đối tác để phân tải

4. **[Quản lý Depot]** Thực hiện các biện pháp tối ưu:
   - Sắp xếp lại khu vực lưu trữ
   - Ưu tiên xử lý các container theo thứ tự đề xuất
   - Phối hợp với các depot đối tác nếu cần

**7. Phản hồi hệ thống**

- Hiển thị cảnh báo trạng thái cao điểm trên dashboard
- Cập nhật real-time về công suất và tình trạng xử lý
- Thông báo tự động cho các bên liên quan

**8. Ngoại lệ (Exception flows)**

- **Quá tải nghiêm trọng:** Kích hoạt phương án dự phòng với depot đối tác
- **Lỗi dự báo:** Điều chỉnh các tham số dự báo và cập nhật kế hoạch
- **Xung đột ưu tiên:** LTA Admin can thiệp để giải quyết

**9. Luồng thay thế (Alternate Path)**

- Sử dụng depot tạm thời hoặc bãi container phụ trợ
- Điều chỉnh lịch trình nhập/xuất container
- Thương lượng với hãng tàu về thời gian lưu container

**10. Trạng thái sau cùng (Post-condition)**

- **Thành công:** Depot trở lại hoạt động bình thường, công suất < 80%
- **Thất bại:** Cần kích hoạt các biện pháp khẩn cấp và can thiệp thủ công

**11. Quy tắc nghiệp vụ (Business Rules)**

- Áp dụng hệ thống điểm ưu tiên cho các container
- Tự động cập nhật trạng thái và công suất depot
- Tuân thủ các quy định an toàn và giới hạn xếp chồng

# **Case 5.2: Tồn đọng do Mất cân đối Kích thước**

**1. Tên kịch bản**

- Quản lý Mất cân đối Container Size (Container Size Imbalance Management)

**2. ID kịch bản**

- FEAT-DEPOT-MGMT-002

**3. Mục tiêu (Business Goal)**

- Giải quyết vấn đề mất cân đối giữa container 20' và 40'
- Tối ưu hóa không gian depot dựa trên kích thước container
- Cải thiện tỷ lệ sử dụng container các loại

**4. Vai trò tham gia (Actors)**

- **Thực hiện chính:** Quản lý Depot
- **Điều phối:** Quản trị viên LTA (LTA Admin)
- **Ảnh hưởng:** Dispatcher các NVT, Hãng tàu

**5. Bối cảnh (Pre-condition)**

- Có sự chênh lệch lớn giữa số lượng container 20' và 40'
- Không gian depot bị phân mảnh do xếp chồng không hiệu quả
- Có nhu cầu không đồng đều cho các loại container

**6. Luồng chính (Happy Path)**

1. **[Hệ thống]** Phát hiện mất cân đối kích thước:
   - Tỷ lệ container 20'/40' vượt ngưỡng cho phép
   - Không gian sử dụng không hiệu quả
   - Thời gian chờ xử lý tăng cho một loại container cụ thể

2. **[Hệ thống]** Kích hoạt cơ chế cân bằng:
   - Phân tích nhu cầu theo kích thước
   - Đề xuất phương án sắp xếp lại
   - Tìm kiếm cơ hội street-turn theo kích thước

3. **[LTA Admin]** Xem xét và phê duyệt các đề xuất:
   - Kế hoạch tái cơ cấu không gian
   - Phương án phân bổ container
   - Chính sách ưu tiên theo kích thước

4. **[Quản lý Depot]** Thực hiện các biện pháp điều chỉnh:
   - Tổ chức lại khu vực lưu trữ
   - Áp dụng quy tắc xếp chồng mới
   - Theo dõi và báo cáo kết quả

**7. Phản hồi hệ thống**

- Hiển thị biểu đồ phân bố kích thước container
- Cập nhật tình trạng sử dụng không gian
- Thông báo về các điều chỉnh cho các bên liên quan

**8. Ngoại lệ (Exception flows)**

- **Thiếu không gian cho một loại container:** Kích hoạt phương án dự phòng
- **Xung đột ưu tiên xử lý:** LTA Admin can thiệp để quyết định
- **Thay đổi đột ngột trong nhu cầu:** Điều chỉnh kế hoạch theo thời gian thực

**9. Luồng thay thế (Alternate Path)**

- Sử dụng depot đối tác cho một loại container cụ thể
- Điều chỉnh chính sách nhận container theo kích thước
- Thực hiện các chiến dịch khuyến khích sử dụng container thiếu nhu cầu

**10. Trạng thái sau cùng (Post-condition)**

- **Thành công:** Tỷ lệ container các loại trở về mức cân bằng
- **Thất bại:** Cần áp dụng các biện pháp hạn chế nhận container

**11. Quy tắc nghiệp vụ (Business Rules)**

- Duy trì tỷ lệ container 20'/40' trong ngưỡng cho phép
- Ưu tiên xử lý loại container đang thiếu
- Áp dụng chính sách giá linh hoạt theo kích thước

# **Case 6.1: Street-turn với Container Lạnh (Reefer)**

**1. Tên kịch bản**

- Quản lý Street-turn Container Lạnh (Reefer Container Street-turn Management)

**2. ID kịch bản**

- FEAT-ST-REEFER-001

**3. Mục tiêu (Business Goal)**

- Tối ưu hóa việc sử dụng container lạnh
- Giảm thiểu thời gian chờ và chi phí điện
- Đảm bảo chất lượng và an toàn cho hàng hóa

**4. Vai trò tham gia (Actors)**

- **Thực hiện chính:** Dispatcher
- **Phê duyệt:** LTA Admin
- **Hỗ trợ kỹ thuật:** Đội kỹ thuật container lạnh
- **Ảnh hưởng:** Khách hàng, Hãng tàu

**5. Bối cảnh (Pre-condition)**

- Có container lạnh vừa dỡ hàng xong
- Có nhu cầu vận chuyển hàng lạnh mới
- Container đáp ứng các yêu cầu kỹ thuật
- Thời gian và khoảng cách phù hợp

**6. Luồng chính (Happy Path)**

1. **[Hệ thống]** Phát hiện cơ hội street-turn container lạnh:
   - Kiểm tra thông số kỹ thuật
   - Xác nhận tính tương thích nhiệt độ
   - Đánh giá thời gian và khoảng cách

2. **[Hệ thống]** Tạo đề xuất ghép nối đặc biệt:
   - Bao gồm yêu cầu kiểm tra kỹ thuật
   - Tính toán chi phí điện và bảo trì
   - Đề xuất lộ trình tối ưu

3. **[Dispatcher]** Xem xét và tạo yêu cầu:
   - Xác nhận các thông số kỹ thuật
   - Đính kèm báo cáo nhiệt độ
   - Yêu cầu kiểm tra container

4. **[Đội kỹ thuật]** Thực hiện kiểm tra:
   - Xác nhận tình trạng máy lạnh
   - Kiểm tra nhiệt độ và độ ẩm
   - Báo cáo kết quả

**7. Phản hồi hệ thống**

- Hiển thị thông số kỹ thuật chi tiết
- Cập nhật trạng thái kiểm tra
- Thông báo cho các bên liên quan

**8. Ngoại lệ (Exception flows)**

- **Lỗi kỹ thuật:** Hủy yêu cầu và chuyển container về depot
- **Không tương thích nhiệt độ:** Tìm kiếm cơ hội khác
- **Thời gian kiểm tra kéo dài:** Điều chỉnh kế hoạch

**9. Luồng thay thế (Alternate Path)**

- Sử dụng depot trung gian có điện
- Thực hiện bảo trì nhanh tại chỗ
- Chuyển đổi sang container lạnh khác

**10. Trạng thái sau cùng (Post-condition)**

- **Thành công:** Container lạnh được tái sử dụng an toàn
- **Thất bại:** Container về depot để bảo trì

**11. Quy tắc nghiệp vụ (Business Rules)**

- Tuân thủ nghiêm ngặt quy trình kiểm tra kỹ thuật
- Đảm bảo tính tương thích nhiệt độ
- Ưu tiên thời gian xử lý nhanh

# **Case 6.2: Street-turn với Container Đặc biệt**

**1. Tên kịch bản**

- Quản lý Street-turn Container Đặc biệt (Special Container Street-turn Management)

**2. ID kịch bản**

- FEAT-ST-SPECIAL-001

**3. Mục tiêu (Business Goal)**

- Tối ưu hóa việc sử dụng container đặc biệt (Open top, Flat rack, Tank)
- Giảm chi phí vận chuyển container rỗng đặc biệt
- Tăng hiệu quả sử dụng container có chi phí cao

**4. Vai trò tham gia (Actors)**

- **Thực hiện chính:** Dispatcher
- **Phê duyệt:** LTA Admin
- **Kiểm tra:** Đội kiểm tra chuyên dụng
- **Ảnh hưởng:** Khách hàng, Hãng tàu

**5. Bối cảnh (Pre-condition)**

- Có container đặc biệt vừa dỡ hàng
- Có nhu cầu vận chuyển hàng đặc biệt mới
- Container đáp ứng yêu cầu kỹ thuật
- Thời gian và địa điểm phù hợp

**6. Luồng chính (Happy Path)**

1. **[Hệ thống]** Phát hiện cơ hội ghép nối đặc biệt:
   - Xác định loại container đặc biệt
   - Kiểm tra tính tương thích hàng hóa
   - Đánh giá yêu cầu kỹ thuật

2. **[Hệ thống]** Tạo đề xuất ghép nối:
   - Bao gồm yêu cầu kiểm tra đặc biệt
   - Tính toán chi phí xử lý
   - Đề xuất phương án vận chuyển

3. **[Dispatcher]** Xem xét và tạo yêu cầu:
   - Xác nhận thông số kỹ thuật
   - Đính kèm báo cáo kiểm tra
   - Yêu cầu đánh giá chuyên sâu

4. **[Đội kiểm tra]** Thực hiện kiểm tra:
   - Đánh giá tình trạng container
   - Kiểm tra các bộ phận đặc biệt
   - Xác nhận khả năng sử dụng

**7. Phản hồi hệ thống**

- Hiển thị thông số kỹ thuật chi tiết
- Cập nhật trạng thái kiểm tra
- Thông báo cho các bên liên quan

**8. Ngoại lệ (Exception flows)**

- **Không đạt yêu cầu kỹ thuật:** Hủy yêu cầu
- **Cần sửa chữa đặc biệt:** Chuyển về depot
- **Thời gian kiểm tra kéo dài:** Điều chỉnh kế hoạch

**9. Luồng thay thế (Alternate Path)**

- Sử dụng depot chuyên dụng
- Thực hiện sửa chữa tại chỗ
- Chuyển đổi sang container khác

**10. Trạng thái sau cùng (Post-condition)**

- **Thành công:** Container được tái sử dụng an toàn
- **Thất bại:** Container về depot để xử lý

**11. Quy tắc nghiệp vụ (Business Rules)**

- Tuân thủ quy trình kiểm tra chuyên dụng
- Đảm bảo tính tương thích với hàng hóa
- Ưu tiên an toàn và chất lượng