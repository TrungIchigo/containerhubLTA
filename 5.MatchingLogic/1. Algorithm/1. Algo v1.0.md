### **Thiết Kế Hệ Thống Tính Điểm Ghép Nối (Matching Score System)**

**Mục tiêu:** Gán một điểm số (từ 0 đến 100) cho mỗi cơ hội ghép nối tiềm năng. Điểm càng cao, cơ hội đó càng lý tưởng và tiết kiệm chi phí.

**Nguyên tắc cốt lõi:** Điểm số được cấu thành từ hai phần: **Điểm Nền (Base Score)** dựa trên các yếu tố cơ bản và **Điểm Thưởng/Phạt (Bonus/Penalty Points)** dựa trên mức độ phức tạp và chi phí phát sinh.

### **Phần 1: Thuật Toán Tính Điểm Tổng (Overall Score Algorithm)**

Generated code

`Tổng Điểm = Điểm Nền (Tối đa 70) + Điểm Thưởng (Tối đa 30) - Điểm Phạt`

---

### **Phần 2: Tính Toán Điểm Nền (Base Score - Max 70 điểm)**

Điểm Nền phản ánh mức độ lý tưởng của một cặp ghép nối dựa trên 3 yếu tố chính: Khoảng cách, Thời gian và Đối tác.

**A. Điểm Khoảng Cách (Tối đa 40 điểm) - Quan trọng nhất**

- **Logic:** Khoảng cách càng ngắn, điểm càng cao.
- **Công thức:** Điểm Khoảng Cách = 40 * (1 - (Khoảng_cách_thực_tế / Ngưỡng_Khoảng_cách_tối_đa))
    - Ngưỡng_Khoảng_cách_tối_đa: Một giá trị cấu hình, ví dụ: **100km**. Những cặp xa hơn 100km sẽ có điểm khoảng cách âm (bị phạt nặng).
- **Ví dụ:**
    - Khoảng cách 5km -> 40 * (1 - (5/100)) = 38 điểm.
    - Khoảng cách 50km -> 40 * (1 - (50/100)) = 20 điểm.
    - Khoảng cách 120km -> 40 * (1 - (120/100)) = -8 điểm (Điểm phạt).

**B. Điểm Thời Gian (Tối đa 20 điểm)**

- **Logic:** Thời gian chờ giữa lúc container rảnh và lúc cần lấy càng ngắn, điểm càng cao.
- **Công thức:** Điểm Thời Gian = 20 * (1 - (Thời_gian_chờ_giờ / Ngưỡng_Thời_gian_chờ_tối_đa))
    - Ngưỡng_Thời_gian_chờ_tối_đa: Một giá trị cấu hình, ví dụ: **72 giờ (3 ngày)**.
- **Ví dụ:**
    - Chờ 2 giờ -> 20 * (1 - (2/72)) = 19.4 điểm.
    - Chờ 24 giờ -> 20 * (1 - (24/72)) = 13.3 điểm.
    - Chờ 80 giờ -> -2.2 điểm (Điểm phạt).

**C. Điểm Đối Tác & Hãng Tàu (Tối đa 10 điểm)**

- **Logic:** Mức độ phức tạp về đối tác và hãng tàu. Giao dịch càng đơn giản, điểm càng cao.
- **Bảng điểm:**
    - **Cùng NVT, Cùng HT:** +10 điểm (Lý tưởng nhất)
    - **Khác NVT, Cùng HT (Marketplace):** +5 điểm (Phức tạp hơn một chút)
    - **Cùng NVT, Khác HT (Cần đổi booking):** +0 điểm (Cần nỗ lực từ người dùng)
    - **Khác NVT, Khác HT:** -5 điểm (Rất phức tạp, chỉ gợi ý khi các yếu tố khác quá tốt)

---

### **Phần 3: Tính Toán Điểm Thưởng/Phạt (Bonus/Penalty Points)**

Điểm này phản ánh các yếu tố về chi phí phát sinh hoặc lợi ích bổ sung.

**A. Điểm Chất Lượng Container (Bonus/Penalty)**

- **Logic:** Nếu chất lượng khớp hoặc tốt hơn yêu cầu, sẽ được cộng điểm. Nếu không, sẽ bị trừ điểm nặng.
- **Bảng điểm:**
    - Chất lượng (LGT) >= Yêu cầu (LLR): **+10 điểm**
    - Chất lượng (LGT) < Yêu cầu (LLR) (cần dùng dịch vụ VAS): **25 điểm** (Phản ánh chi phí và sự phức tạp phát sinh)

**B. Điểm Kịch Bản Phức Hợp (Bonus)**

- **Logic:** Thưởng điểm cho các kịch bản mà hệ thống đã "thông minh" giải quyết được một vấn đề.
- **Bảng điểm:**
    - **Street-turn "Tại Depot" (Case 1.1B):** **+15 điểm**. Đây là cơ hội cực kỳ tốt, tiết kiệm được cả một chuyến xe không tải, xứng đáng được điểm thưởng cao.
    - **Kết hợp COD + Street-turn:** **+5 điểm**. Mặc dù phức tạp, nhưng việc hệ thống tìm ra giải pháp này cũng là một giá trị gia tăng.
    - **Sử dụng Bãi GPG/Depot Đối tác (chờ lâu):** **+5 điểm**. Tương tự như trên.

**C. Điểm Uy tín Đối tác (Bonus/Penalty - Áp dụng cho Marketplace)**

- **Logic:** Điểm thưởng dựa trên đánh giá của đối tác "chào bán" cơ hội.
- **Công thức:** Điểm Uy tín = (Điểm_đánh_giá_TB - 3) * 5
    - Điểm TB là 3 (trung bình) -> 0 điểm thưởng/phạt.
    - Điểm TB là 5 -> (5-3)*5 = +10 điểm thưởng.
    - Điểm TB là 1 -> (1-3)*5 = -10 điểm phạt.

---

### **Giao Diện Hiển Thị Cho Người Dùng**

Trên Dashboard, khu vực **"Gợi Ý Tái Sử Dụng"** sẽ được thiết kế lại để hiển thị điểm số một cách trực quan.

**Thiết kế mỗi thẻ gợi ý:**

- **Góc trên bên trái:** Một vòng tròn hoặc thanh tiến trình hiển thị **Tổng Điểm**. Ví dụ: 85/100 với màu xanh lá đậm.
- **Bên cạnh điểm số:** Một **tag/badge** ghi rõ **Loại Kịch Bản**: Nội bộ, Marketplace, Kết hợp COD, Lưu trữ tại bãi...
- **Phần trung tâm:** Thông tin tóm tắt về hai lệnh như cũ.
- **Phần dưới:** Chi tiết các điểm thành phần. Có thể dùng icon:
    - 📍 Khoảng cách: 38/40
    - ⏱️ Thời gian: 19/20
    - 🤝 Đối tác: 10/10
    - ✨ Chất lượng: +10
- **Góc dưới bên phải:** Nút hành động tương ứng ("Tạo Yêu cầu", "Tạo Yêu cầu Kết hợp"...).

**Kết quả:**

Dispatcher Anna giờ đây không chỉ thấy một danh sách các gợi ý. Cô ấy thấy một **bảng xếp hạng các cơ hội**, được sắp xếp theo điểm số từ cao đến thấp. Cô có thể nhanh chóng so sánh, hiểu tại sao một cơ hội được đánh giá cao hơn, và tự tin ra quyết định chọn phương án tối ưu nhất.