## **Hệ Thống Tính Điểm Ghép Nối V2.0 (Đã Cải Tiến)**

**Mục tiêu:** Giữ nguyên sự minh bạch của hệ thống cũ nhưng khắc phục các điểm yếu về "âm điểm quá sâu", "trọng số cứng" và "penalty đột biến" bằng các kỹ thuật chuẩn hóa và cấu trúc lại.

### **Phần 1: Tái Cấu Trúc Thuật Toán & Công Thức Tính Điểm**

**A. Thuật Toán Tính Điểm Tổng (Overall Score Algorithm)**

Chúng ta sẽ giữ nguyên thang điểm 100 nhưng tái cấu trúc lại các thành phần một cách module hóa hơn.

Generated code

`Tổng Điểm = Điểm Tối Ưu Vận Hành (Max 60) + Điểm Đối Tác & Tình Huống (Max 40)`

- **Điểm Tối Ưu Vận Hành:** Tập trung vào các yếu tố vật lý cốt lõi: Khoảng cách và Thời gian.
- **Điểm Đối Tác & Tình Huống:** Tập trung vào các yếu tố nghiệp vụ: Mức độ phức tạp của giao dịch và chất lượng các bên liên quan.

---

### **Phần 2: Thành Phần 1 - Điểm Tối Ưu Vận Hành (Max 60 điểm)**

**A. Điểm Khoảng Cách (Tối đa 40 điểm)**

- **Logic Cải tiến (Áp dụng Clipping & Normalization):**
    1. **Chuẩn hóa Khoảng cách (Normalization):**
        
        Distance_Norm = Khoảng_cách_thực_tế_km / Ngưỡng_Khoảng_cách_tham_chiếu
        
        - Ngưỡng_Khoảng_cách_tham_chiếu: Giữ nguyên là **100km**. Đây là khoảng cách "lý tưởng" mà chúng ta mong muốn.
    2. **Giới hạn Giá trị (Clipping):** Đảm bảo giá trị chuẩn hóa không vượt quá 1 để tránh điểm âm.
        
        Clipped_Distance_Norm = min(Distance_Norm, 1.0)
        
    3. **Công thức tính điểm cuối cùng:**
        
        Điểm Khoảng Cách = 40 * (1 - Clipped_Distance_Norm)
        
- **Kết quả:**
    - Khoảng cách 0km -> 40 * (1 - 0) = 40 điểm.
    - Khoảng cách 50km -> 40 * (1 - 0.5) = 20 điểm.
    - Khoảng cách 100km -> 40 * (1 - 1) = 0 điểm.
    - Khoảng cách 120km -> min(1.2, 1.0) = 1.0 -> 40 * (1 - 1) = 0 điểm.
    - **=> Điểm Khoảng Cách giờ đây sẽ luôn nằm trong khoảng [0, 40]. Không còn điểm âm.**

**B. Điểm Thời Gian (Tối đa 20 điểm)**

- **Logic Cải tiến (Áp dụng Clipping & Normalization):** Tương tự như Điểm Khoảng Cách.
    1. **Chuẩn hóa Thời gian:**
        
        Time_Norm = Thời_gian_chờ_giờ / Ngưỡng_Thời_gian_chờ_tham_chiếu
        
        - Ngưỡng_Thời_gian_chờ_tham_chiếu: Giữ nguyên là **72 giờ**.
    2. **Giới hạn Giá trị:**
        
        Clipped_Time_Norm = min(Time_Norm, 1.0)
        
    3. **Công thức tính điểm cuối cùng:**
        
        Điểm Thời Gian = 20 * (1 - Clipped_Time_Norm)
        
- **Kết quả:**
    - Chờ 0 giờ -> 20 điểm.
    - Chờ 72 giờ -> 0 điểm.
    - Chờ 80 giờ -> Vẫn là 0 điểm.
    - **=> Điểm Thời Gian giờ đây sẽ luôn nằm trong khoảng [0, 20].**

---

### **Phần 3: Thành Phần 2 - Điểm Đối Tác & Tình Huống (Max 40 điểm)**

**A. Điểm Mức độ Phức tạp Giao dịch (Tối đa 15 điểm)**

- **Logic:** Phản ánh nỗ lực cần thiết để thực hiện giao dịch.
- **Bảng điểm:**
    - **Street-turn "Tại Depot" (Cùng NVT):** +15 điểm (Cơ hội vàng, dễ thực hiện nhất).
    - **Street-turn "Trên đường" (Cùng NVT):** +12 điểm (Kịch bản lý tưởng).
    - **Marketplace (Khác NVT, Cùng HT):** +8 điểm (Cần LTA điều phối).
    - **Kết hợp COD + Street-turn:** +5 điểm (Phức tạp hơn nhưng hệ thống đã hỗ trợ).
    - **Sử dụng Bãi ảo/VAS:** +5 điểm (Tương tự trên).
    - **Cùng NVT, Khác HT (Cần đổi booking):** +2 điểm (Đòi hỏi nhiều nỗ lực từ người dùng).

**B. Điểm Chất lượng & Uy tín (Tối đa 25 điểm)**

- **Logic Cải tiến (Modular Bonus/Penalty):** Tách thành hai phần nhỏ để tránh một yếu tố lấn át tất cả.
- **1. Điểm Khớp Chất lượng (Tối đa 15 điểm):**
    - Chất lượng LGT >= Yêu cầu LLR: **+15 điểm** (Hoàn hảo).
    - Chất lượng LGT < Yêu cầu LLR: **+0 điểm**. Thay vì trừ điểm nặng, chúng ta chỉ không cộng điểm. Chi phí của dịch vụ VAS sẽ được hiển thị riêng như một yếu tố để người dùng cân nhắc, không làm "ô nhiễm" điểm số.
- **2. Điểm Uy tín Đối tác (Tối đa 10 điểm - Áp dụng cho Marketplace):**
    - Điểm Uy tín = (Điểm_đánh_giá_TB / 5) * 10
    - Ví dụ:
        - Đối tác 5 sao -> (5/5) * 10 = 10 điểm.
        - Đối tác 3 sao -> (3/5) * 10 = 6 điểm.
        - Đối tác 1 sao -> (1/5) * 10 = 2 điểm.
    - **=> Điểm Uy tín giờ đây sẽ luôn nằm trong khoảng [2, 10],** phản ánh đúng giá trị nhưng không tạo ra điểm phạt âm.

---

## **Phân Tích Cách Thuật Toán Xử Lý Các Kịch Bản Lồng Chéo**

**Thuật toán:** Tổng Điểm = Điểm Khoảng Cách (0-40) + Điểm Thời Gian (0-20) + Điểm Mức độ Phức tạp (2-15) + Điểm Chất lượng & Uy tín (0-25)

Hãy áp dụng nó vào các kịch bản của bạn:

**1. Kịch bản: Cùng NVT, cùng HT, khoảng cách gần, chất lượng tốt**

- **Điểm Khoảng Cách:** Gần như tối đa (ví dụ: 38/40).
- **Điểm Thời Gian:** Gần như tối đa (ví dụ: 19/20).
- **Điểm Mức độ Phức tạp:** +12 (Street-turn nội bộ trên đường).
- **Điểm Chất lượng & Uy tín:** +15 (Chất lượng khớp).
- **=> Tổng điểm:** ~ **84/100**. Đây sẽ là một trong những gợi ý có điểm cao nhất.
- **Hiển thị cho user:**
    - **Điểm:** 🟢 84/100
    - **Loại kịch bản:** Street-turn Nội bộ
    - **Tác vụ thêm:** Không có.

**2. Kịch bản: Cùng NVT, khác HT, khoảng cách xa (cần COD), chất lượng kém (cần VAS tại bãi GPG)**

- **Phân tích rào cản:** Khác HT, Xa, Bẩn. Hệ thống sẽ ưu tiên xử lý "Khác HT" trước.
- **Bước 1 (Gợi ý cho người dùng):** "Để tận dụng cơ hội này, bạn cần đổi booking sang hãng tàu X." -> Giả sử người dùng đã thực hiện.
- **Bước 2 (Hệ thống tái phân tích):** Kịch bản giờ là Cùng NVT, Cùng HT, Xa, Bẩn.
- **Tính điểm:**
    - **Điểm Khoảng Cách:** 0/40 (Vì > 100km, điểm bị giới hạn ở 0).
    - **Điểm Thời Gian:** Giả sử thời gian gần (ví dụ: 19/20).
    - **Điểm Mức độ Phức tạp:** +5 (Kịch bản kết hợp COD).
    - **Điểm Chất lượng & Uy tín:** +0 (Vì chất lượng không khớp).
    - **=> Tổng điểm:** ~ **24/100**. Điểm rất thấp, thể hiện sự phức tạp và chi phí.
- **Hiển thị cho user:**
    - **Điểm:** 🔴 24/100
    - **Loại kịch bản:** Kết hợp COD + Street-turn + Dịch vụ VAS
    - **Tác vụ phải làm thêm:**
        - [Yêu cầu COD] Đổi nơi trả về Bãi GPG.
        - [Dịch vụ VAS] Thực hiện Vệ sinh/Sửa chữa tại Bãi GPG.
        - [Chi phí phát sinh] Phí COD + Phí VAS ước tính: [số tiền].

**3. Kịch bản: Khác NVT, cùng HT, thời gian gần, chất lượng kém (cần VAS tại depot đối tác)**

- **Tính điểm:**
    - **Điểm Khoảng Cách:** Giả sử khoảng cách gần (ví dụ: 35/40).
    - **Điểm Thời Gian:** Gần như tối đa (ví dụ: 19/20).
    - **Điểm Mức độ Phức tạp:** +8 (Marketplace).
    - **Điểm Chất lượng & Uy tín:** +0 (Chất lượng không khớp) + Điểm Uy tín đối tác (ví dụ: 8/10).
    - **=> Tổng điểm:** ~ **70/100**. Vẫn là một cơ hội tốt dù có vấn đề chất lượng.
- **Hiển thị cho user:**
    - **Điểm:** 🟡 70/100
    - **Loại kịch bản:** Marketplace + Dịch vụ VAS
    - **Đối tác:** Công ty Vận tải XYZ (⭐ 4.2)
    - **Tác vụ phải làm thêm:**
        - [Dịch vụ VAS] Container cần được xử lý tại Depot Đối tác trước khi giao.
        - [Chi phí phát sinh] Phí VAS ước tính: [số tiền], sẽ do bên bạn (bên có cont bẩn) chi trả.

**4. Kịch bản: Khác NVT, khác HT, thời gian chờ > 24h (cần gửi bãi GPG)**

- **Phân tích rào cản:** Khác NVT, Khác HT, Thời gian chờ lâu.
- **Bước 1 (Gợi ý cho người dùng):** Gợi ý người dùng đổi booking trước. Giả sử người dùng đã thực hiện.
- **Bước 2 (Hệ thống tái phân tích):** Kịch bản giờ là Khác NVT, Cùng HT, Thời gian chờ > 24h.
- **Tính điểm:**
    - **Điểm Khoảng Cách:** Giả sử gần (ví dụ: 38/40).
    - **Điểm Thời Gian:** Sẽ thấp vì phải chờ lâu (ví dụ: chờ 48h -> 20 * (1 - 48/72) = 6.7/20).
    - **Điểm Mức độ Phức tạp:** +5 (Sử dụng Bãi ảo/Lưu trữ).
    - **Điểm Chất lượng & Uy tín:** Giả sử chất lượng tốt và uy tín cao (15/15 + 10/10).
    - **=> Tổng điểm:** ~ **74.7/100**. Điểm cao, cho thấy đây là một cơ hội rất đáng để lưu trữ và chờ đợi.
- **Hiển thị cho user:**
    - **Điểm:** 🟢 75/100
    - **Loại kịch bản:** Marketplace + Lưu trữ tại Bãi GPG
    - **Đối tác:** Công ty Vận tải UVW (⭐ 5.0)
    - **Tác vụ phải làm thêm:**
        - [Lưu trữ] Yêu cầu gửi container vào Bãi GPG và chờ [số] giờ.
        - [Chi phí phát sinh] Phí lưu bãi ước tính: [số tiền].